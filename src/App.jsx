import './App.css'
import React, { useState, useEffect, useMemo } from 'react';
import { 
  Brain, 
  Target, 
  Award, 
  ChevronRight, 
  ChevronLeft, 
  CheckCircle2, 
  XCircle, 
  Activity, 
  Utensils, 
  Zap, 
  BookOpen, 
  ArrowUpCircle, 
  RefreshCcw, 
  HelpCircle, 
  Lightbulb, 
  GraduationCap, 
  Book, 
  Search, 
  Clock, 
  AlertTriangle, 
  Star, 
  Info, 
  Tag, 
  ShoppingBag, 
  Save, 
  Cloud, 
  Trophy, 
  Dumbbell 
} from 'lucide-react';

// --- Firebase Imports ---
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'firebase/auth';
import { getFirestore, doc, setDoc, getDoc, onSnapshot } from 'firebase/firestore';

// --- Firebase Initialization ---
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
const appId = typeof __app_id !== 'undefined' ? __app_id : 'nutrition-iq-default';

let auth = null;
let db = null;

if (firebaseConfig) {
  const app = initializeApp(firebaseConfig);
  auth = getAuth(app);
  db = getFirestore(app);
}

// --- Configuration: Category Definitions ---
const CATEGORY_CONFIG = {
  'Awareness': { name: '基礎認知', icon: BookOpen, desc: '辨識食物種類、真假蔬菜與隱形地雷' },
  'Quantification': { name: '份量估算', icon: Utensils, desc: '掌握手掌法則、熱量密度與食物重量' },
  'Scenario': { name: '外食實戰', icon: Zap, desc: '便利商店、火鍋、自助餐的最佳選擇攻略' },
  'Physiology': { name: '生理機制', icon: Activity, desc: '了解代謝、荷爾蒙與運動營養' },
  'Myth': { name: '迷思破解', icon: Brain, desc: '破解常見的減肥偽科學與網路謠言' },
  'Label': { name: '標籤解碼', icon: Target, desc: '看懂營養標示，計算糖分與實際熱量' }
};

// --- Data: Fitness Guide Content (Full Original PDF Content - VERBATIM) ---
const FITNESS_GUIDE_DATA = [
  {
    id: 'ch0-start',
    title: '第零章：啟程',
    subtitle: '獻給決定重生的你',
    readTime: '3 min',
    content: [
      { type: 'quote', text: '教練的話：「在你翻開這份計畫、踏入健身房的第一步之前，我想先跟你確認一件事：你是認真的嗎？如果你心裡想的是『有沒有那種三週就能變壯、變瘦的捷徑』，那我可以很負責地告訴你：這份指南不適合你，現在就可以關掉它了。」' },
      { type: 'highlight', title: '醜話說在前面：誰不適合這份指南？', text: '如果你屬於以下幾種人，請不要浪費時間：\n\n• 尋求「三週奇蹟」的幻想家：脂肪不是三週長出來的，肌肉也不可能三週就變巨。如果你只想要速成，去買修圖軟體會比較快。\n\n• 只想「聽」不想「練」的評論家：知識如果不轉化為汗水，那只是腦袋裡的垃圾。\n\n• 遇到一點痠痛就想退縮的逃避者：健身房不是按摩院，這裡的每分進步都帶著一點點痛苦。' },
      { type: 'text', text: '如果你還在看這行字，代表你已經準備好接受挑戰了。很好，那我們來談談真相。' },
      { type: 'section', title: '關於健身，你必須知道的真相' },
      { type: 'list', items: [
        '1. 這裡沒有速成，只有累積：健身房不是便利商店。你的每一吋線條、每一分力量，都是用汗水與時間一點一滴交換而來的。真正的改變，發生在那些你覺得想放棄卻依然堅持下去的瞬間。',
        '2. 這是一場「決心」的考試：這份指南是寫給那些「真的想變強」的人。它適合願意蹲下來研究器材、願意在疲憊時依然保持動作標準、願意為了目標調整作息的勇者。',
        '3. 你是自己的雕刻家：大理石在變成雕像之前，也只是一塊平凡的石頭。每一次的推舉、每一次的痠痛，都是你在雕琢那個更理想的自己。'
      ]},
      { type: 'section', title: '給你的動力補給' },
      { type: 'text', text: '不要害怕你的起點低，該害怕的是你從未開始。健身房裡那些強壯的人，也都曾和你一樣，拿著最輕的啞鈴、感受著最尷尬的目光。\n\n這不只是一份訓練菜單，這是一份你與自己簽下的契約。\n\n當你感到痛苦時，那是脂肪在哭泣，是肌肉在覺醒。如果你願意學習、願意等待、願意日復一日地重複那些平凡的動作，你已經贏過了那個只會幻想的昨天的自己。\n\n現在，深呼吸。收起你的焦慮，帶上你的決心。我們不求一步登天，我們只求每天進步一點點。\n\n準備好了嗎？既然沒被嚇跑，那就讓我們開始吧！' }
    ]
  },
  {
    id: 'ch1-matrix',
    title: '第一章：訓練目標與強度矩陣',
    subtitle: '打造你的專屬計畫',
    readTime: '5 min',
    content: [
      { type: 'quote', text: '教練的話：「新手最常問我：『教練，我到底要拿多重？要練幾次？』這不是隨便抓個數字就好，而是要根據你想變成什麼樣子來決定。這份矩陣就是你的導航系統。」' },
      { type: 'section', title: '核心訓練矩陣 (The Master Matrix)' },
      { type: 'text', text: '這張表是所有訓練計畫的靈魂。請先根據你「現在最想達成的目標」選擇一個方案。' },
      { type: 'card', title: '1. 想變更壯 (肌肥大)', content: '● 推薦次數 (每組)：8-12次\n● 推薦組數 (每個動作)：3-4組\n● 休息時間：60-90秒\n● 身體的實際變化：肌肉體積增加，穿衣服變挺、變厚。' },
      { type: 'card', title: '2. 想變更強 (最大力量)', content: '● 推薦次數 (每組)：3-6次\n● 推薦組數 (每個動作)：3-5組\n● 休息時間：3-5分鐘\n● 身體的實際變化：神經系統變強，能舉起更重的重量。' },
      { type: 'card', title: '3. 想練線條 (肌耐力)', content: '● 推薦次數 (每組)：15-20次\n● 推薦組數 (每個動作)：2-3組\n● 休息時間：30-45秒\n● 身體的實際變化：提升燃脂效率，肌肉線條更精實。' },
      { type: 'section', title: '深度拆解：三大目標的邏輯' },
      { type: 'text', text: '1. 我想變更壯：肌肥大 (Hypertrophy)\n• 適合誰：覺得自己太瘦、想撐起衣服、想讓身材有明顯起伏的人。\n• 教練細節：*這是大多數新手的首選。重點在於「肌肉累積壓力」。最後2-3下應該感覺到肌肉在燃燒，但動作依然保持準確。\n○ 休息時間：90秒是黃金時間，讓肌肉恢復一點力氣，但又不讓代謝壓力完全消失。\n\n2. 我想變更強：最大力量 (Max Strength)\n• 適合誰：想要挑戰大重量、對數字進步有成就感、想打好身體基礎的人。\n• 教練細節：這是「神經系統」的訓練。重量通常很重（對新手來說）所以每組次數少。\n○ 休息時間：為什麼要休到3-5分鐘？因為神經系統恢復比肌肉慢，休息不夠，下一組你就舉不動了。\n○ 注意：新手在前兩個月不建議直接衝1RM（只能舉一下的重量），先從5-6次開始。\n\n3. 我想練線條：肌耐力 (Endurance/Definition)\n• 適合誰：想瘦身、提升體能、或是希望增加日常活力的生活忙碌者。\n• 教練細節：*這不是真的讓你「肌肉變小」，而是透過高次數增加能量消耗。\n○ 休息時間：縮短到30秒，讓你的心跳維持在高檔，增加後燃效應。' },
      { type: 'section', title: '新手必懂：如何判斷「重量拿對了」？' },
      { type: 'text', text: '很多新手會拿太輕（像在復健）或拿太重（動作壞掉）。我們引入一個簡單的概念：RPE（自覺強度感）。' },
      { type: 'highlight', title: 'RPE 判斷法則', text: '• RPE 7-8分 (目標)：舉完設定的次數後，感覺「還能再舉 2-3 下」。這是新手的最佳成長區間。\n\n• RPE 10分 (危險)：舉完後感覺「打死我也舉不動下一個了」。新手不建議每組都練到力竭，這會導致神經過度疲勞，影響日常生活與學習。' },
      { type: 'section', title: '進階法則：漸進式超負荷 (Progressive Overload)' },
      { type: 'text', text: '這是健身能賺錢、能成功的唯一秘訣。你的身體很聰明，如果永遠拿一樣的重量，它就不會再成長。\n\n每兩週，請嘗試達成以下其中一項進步：' },
      { type: 'list', items: [
        '1. 重量增加：例如啞鈴從 5kg 變成 6kg。',
        '2. 次數增加：原本舉 10 下，現在能舉 12 下。',
        '3. 品質提升：原本舉 10 下會晃，現在 10 下都非常穩。',
        '4. 休息減少：休息時間從 90 秒縮短為 75 秒。'
      ]},
      { type: 'quote', text: '教練的「新手」特別建議：身為新手的你，我建議前三個月優先選擇「肌肥大 (8-12次)」方案。理由：這個區間對關節壓力適中，且能在短時間內看到體態改變（穿衣服變好看），這種成就感會支撐你長期堅持訓練。' }
    ]
  },
  {
    id: 'ch2-survival',
    title: '第二章：健身房生存指南',
    subtitle: '心態、安全與選點',
    readTime: '4 min',
    content: [
      { type: 'quote', text: '教練的話：「進健身房的第一天，最難的不是舉起槓鈴，而是推開大門的那一刻。這章要教你如何像個老手一樣在健身房『生存』，並選到最適合你的訓練基地。」' },
      { type: 'section', title: '一、心態建設：沒人在看你，真的！' },
      { type: 'text', text: '新手最怕的兩件事：「我動作好醜」和「別人在看我」。' },
      { type: 'list', items: [
        '1. 聚光燈效應：其實健身房裡99%的人都在看著鏡子裡的自己，想着姿勢對不對或肌肉有沒有變大。除非你在器材上睡覺，否則沒人會盯著你。',
        '2. 老手都很友善：那些看起來很壯的「巨巨」，大部分都對認真訓練的新手很有好感。如果你真的不懂器材怎麼用，禮貌地問一聲「請問這個怎麼調？」，他們通常很樂意幫忙。',
        '3. 穿得舒服比穿得專業重要：不用急著買全套名牌壓縮衣，一件排汗衫、一條彈性運動褲和一雙平底鞋（如Converse 或慢跑鞋）就夠了。'
      ]},
      { type: 'section', title: '二、健身房隱形規則 (新手禮儀)' },
      { type: 'text', text: '想在健身房受人尊重，請記住以下四點：' },
      { type: 'list', items: [
        '器材不長期佔用：不要坐在器材上滑手機超過 2 分鐘。如果真的要回訊息，請站起來讓給別人。',
        '物歸原位：啞鈴用完請放回原本的位置，槓片要卸下來。這是健身房最高級的美德。',
        '保持清潔：訓練完如果器材上有汗水，請用毛巾或現場提供的酒精擦拭。',
        '詢問「組間借練」：如果某個器材有人在用，你可以問：「請問可以跟你輪流做嗎？」這在健身房是很正常的行為。'
      ]},
      { type: 'section', title: '三、潛在危險與預防：別讓訓練變成復健' },
      { type: 'text', text: '新手受傷通常不是因為重量，而是因為「不小心」。' },
      { type: 'highlight', title: '四大危險與預防', text: '1. 英雄主義 (Ego Lifting)\n• 危險：為了面子拿超過自己負荷的重量。\n• 預防：記住第一章的RPE法則。動作變形就代表太重了。\n\n2. 鎖死關節 (Locked Joints)\n• 危險：在推舉或推腿時，將手肘或膝蓋完全打直並「鎖死」。\n• 預防：推到底時保持關節微彎，用肌肉支撐重量，而不是靠骨頭卡住。\n\n3. 憋氣 (Valsalva Maneuver)\n• 危險：運動時全程憋氣，容易導致血壓飆升、頭暈甚至昏倒。\n• 預防：掌握「發力時呼氣，還原時吸氣」的原則。如果不確定，就保持規律呼吸。\n\n4. 忽略安全扣件\n• 危險：槓鈴兩邊不夾安全夾，重量不平均時槓片會滑落彈飛。\n• 預防：只要有上槓片，不論多輕都要夾上安全夾。' },
      { type: 'section', title: '四、如何選擇你的第一個訓練基地？' },
      { type: 'text', text: '新手選健身房，「距離」永遠是第一考量。' },
      { type: 'card', title: '1. 國民運動中心 (首選推薦)', content: '• 優勢：\n * 以分計費/單次收費：不用簽長約，對新手壓力最小(一小時約50元)。\n * 氣氛放鬆：裡面各種體型、年齡的人都有，比較不會有壓力。\n * 器材齊全：基本的機械式器材與自由重量區都很完整。\n• 適合誰：想試水溫、不想被合約綁架、預算有限的學生。' },
      { type: 'card', title: '2. 連鎖大型健身房 (如World Gym, 健身工廠)', content: '• 優勢：器材最頂級、據點多、有洗澡設備和團課。\n• 缺點：需要簽長約(1-3年)，業務推銷壓力大。\n• 適合誰：確定會長久練下去、需要高級淋浴間的上班族。' },
      { type: 'card', title: '3. 小型工作室 (Studio)', content: '• 優勢：人少、安靜、教練素質通常較平均。\n• 適合誰：預算充足、極度害怕人群、想專門找1對1教練的人。' },
      { type: 'text', text: '教練的新手選點建議：\n我強烈建議新手先去家或學校附近的「國民運動中心」練一個月。\n\n• 為什麼？因為這一個月是你的「觀察期」。如果你發現自己一週能去三次且不排斥，再去考慮簽長期合約。這能幫你省下大筆浪費掉的會員費(那也是你的資產!)。' }
    ]
  },
  {
    id: 'ch3-intro',
    title: '第三章：動作指導總綱',
    subtitle: '為什麼我們從「大肌群」開始？',
    readTime: '3 min',
    content: [
      { type: 'quote', text: '教練的話：「進了健身房，你的體力與時間就是最寶貴的資源。新手最常犯的錯就是一進去就拿著小啞鈴猛練二頭肌。這章要告訴你，如何把力氣花在刀口上，用最短的時間看到最大的改變。」' },
      { type: 'section', title: '一、優先順序：大肌群 vs. 小肌群' },
      { type: 'text', text: '在健身房裡，肌肉也有「權重」之分。我們將全身肌肉分為兩大類：\n1. 大肌群（核心標的）：腿部、背部、胸部。\n2. 小肌群（輔助標的）：肩膀（三角肌）、手臂（二、三頭肌）、小腿、核心。' },
      { type: 'highlight', title: '為什麼要先練大肌群？', text: '• 投資報酬率最高：大肌群佔了身體大部分的重量。練腿消耗的熱量和激發的荷爾蒙分泌，遠比練手臂多。\n\n• 帶動全身成長：當你做大重量的深蹲(練腿)或推舉(練胸)時，你的核心和手臂其實都在幫忙。練大肌群的同時，小肌群也會跟著變強。\n\n• 體力分配：大動作需要最多的專注力和能量。如果你先練完手臂，等一下推胸時手臂先累了，你就沒辦法讓胸部得到充分的訓練。' },
      { type: 'section', title: '二、動作邏輯：複合動作 vs. 孤立動作' },
      { type: 'text', text: '這份指南會優先教你「複合動作 (Compound Movements)」。\n\n• 什麼是複合動作？同時動到兩個以上關節的動作。例如深蹲(動到髖、膝、踝關節)、胸推(動到肩、肘關節)。\n\n• 優點：\n1. 效率極高(一次練到多塊肌肉)。\n2. 更接近生活中的發力模式(搬重物、起立坐下)。\n3. 能舉起更重的重量，進步感最明顯。' },
      { type: 'section', title: '三、每一天的訓練順序 (Order of Operations)' },
      { type: 'text', text: '不管你是練全身還是分部位練，請遵守這個黃金順序：'},
      { type: 'list', items: [
        '1. 暖身 (Warm-up)：讓身體發熱，活化待會要練的關節(約5-10分鐘)。',
        '2. 最難的複合動作：趁體力最好時，挑戰今天最重的動作(如：深蹲、胸推)。',
        '3. 輔助/孤立動作：當大肌肉累了，再用小重量針對細節加強(如：側平舉、二頭彎舉)。',
        '4. 核心與收尾：最後才練腹肌或伸展放鬆。'
      ]},
      { type: 'section', title: '四、給新手的「發力」口訣' },
      { type: 'text', text: '新手最怕「練胸結果手酸，練背結果脖子酸」。在接下來的動作指導中，我會一直重複這兩個原則：' },
      { type: 'card', title: '原則 A', content: '想像你的手只是「勾子」。在做拉的動作時，不要想着用手抓，要想著用「手肘」往後帶。' },
      { type: 'card', title: '原則 B', content: '腳掌要有「抓地力」。做推的動作時，力量是從腳底傳導上來的，要把自己穩穩地釘在地板上。' },
      { type: 'quote', text: '教練的新手特別建議\n\n「姿勢第一，重量第二。」\n\n在接下來的具體動作指導中，請先用「最輕的重量」甚至「徒手」練習到動作完全標準(RPE 4-5)。當你能在不晃動、不憋氣的情況下完成12下，再考慮加重。這不是浪費時間，這是在幫你未來的50萬資產保命，因為受傷後的醫療費才是健身最大的虧損。' }
    ]
  },
  {
    id: 'ch3-1-chest',
    title: '3-1：動作指導 —— 胸部主題 (Chest)',
    subtitle: '打造厚實的門面',
    readTime: '4 min',
    content: [
      { type: 'quote', text: '教練的話：「胸部訓練的核心就在一個『推』字。很多新手練胸會練到手酸、肩膀痛，那是因為你沒把肩膀固定住。想像你的胸部是一扇門，我們要用力把這扇門推開！」' },
      { type: 'section', title: '為什麼要練胸？(訓練優點)' },
      { type: 'text', text: '• 視覺效果：胸肌是上半身最顯眼的肌肉之一。練好胸肌能幫你撐起T恤與襯衫，讓肩膀看起來更寬，改善「窄肩」的視覺感。\n• 身體影響：強大的胸肌能提供強大的「推力」，無論是搬重物、推門或是跌倒時的支撐力都非常有幫助。\n• 體態修正：對於長期久坐、低頭讀書的考生來說，適度的胸部訓練配合背部訓練，能幫你拉開緊縮的肩膀，改善視覺上的「含胸駝背」。' },
      { type: 'section', title: '1. 新手首選：機械式胸推 (Machine Chest Press)' },
      { type: 'text', text: '如果你是第一天進健身房，這是我唯一推薦你做的胸部動作。它的軌跡固定，安全性最高，非常適合用來感受胸肌發力。\n\n1. 主要訓練肌群：胸大肌全體。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 設定：調整座椅高度，讓握把對準你的「乳頭連線」。\n○ 固定：背部緊貼椅背，肩膀向後收、向下壓（想像把肩膀塞進褲子後口袋）。\n○ 發力：握緊握把，呼氣往前方推出去，手肘不要完全打直（保留一點點彎曲）。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 聳肩：肩膀快碰到耳朵，這會讓你的脖子很酸。\n○ 拱腰：屁股離開椅子，這會傷到下背。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3-4組 × 8-12次(休息90秒)。\n○ 想變更強(最大力量)：3-5組 × 5-8次(休息3分鐘)。\n○ 想練線條(肌耐力)：2-3組 × 15-20次(休息45秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：史密斯機胸推、啞鈴平躺胸推。\n\n7. 具體影響：這是增加胸部「厚度」最有效、最安全的方式。' },
      { type: 'section', title: '2. 自由重量基礎：啞鈴平躺胸推 (Dumbbell Chest Press)' },
      { type: 'text', text: '當你習慣機械式的感覺後，可以嘗試啞鈴。它能訓練你左右手的平衡，活動範圍比機械更大，刺激更深。\n\n1. 主要訓練肌群：胸大肌、三頭肌(手臂後側)、肩膀前側(前三角肌)。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 預備：躺在長椅上，雙腳踩死地板。啞鈴拿在胸口上方。\n○ 夾角：手肘與身體不要呈90度(太傷肩)，要呈大約45-60度(像箭頭一樣)。\n○ 軌跡：往上推時，想像兩個啞鈴在上方匯合，但「不要互相碰撞」。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 啞鈴亂晃：這是因為重量太重或核心沒收緊。\n○ 碰撞聲：在最高點敲擊啞鈴，這會讓你失去肌肉的張力。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n● 想變更壯(肌肥大)：3組 × 10-12次(休息90秒)。\n○ 想變更強(最大力量)：3組 × 6-8次(休息3分鐘)。\n○ 想練線條(肌耐力)：3組 × 15次(休息60秒)。\n\n5. 建議一週頻率：每週1-2次。\n\n6. 可替代動作：槓鈴胸推。\n\n7. 具體影響：幫助解決「左右胸不對稱」的問題，並增加胸肌外側的輪廓感。' },
      { type: 'section', title: '3. 內側夾擊：機械式蝴蝶機 (Pec Deck Fly)' },
      { type: 'text', text: '這是一個「孤立動作」，不需要手臂出太多力，專門用來找胸部中間那條溝的感覺。\n\n1. 主要訓練肌群：胸大肌內側。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 姿勢：坐挺，雙手握住把手，手肘微彎。\n○ 發力：想像你在「抱一棵大樹」。用「手肘」帶動手臂往中間靠攏。\n○ 感受：在中間停留1秒，用力擠壓胸肌，再慢慢放回去。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 手太直：這會讓肩膀壓力太大。\n○ 放太快：往後放的時候要控制住，不要被器材拉著走。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 12-15次(休息60秒)。\n○ 想變更強(最大力量)：此動作不建議做低次數大重量，易傷肩。\n○ 想練線條(肌耐力)：3組 × 20次(休息30秒)。\n\n5. 建議一週頻率：每週1-2次(通常放在胸部訓練的最後一項)。\n\n6. 可替代動作：滑輪夾胸(Cables)。\n\n7. 具體影響：刻畫胸肌中線(事業線)，讓胸肌看起來更精緻、線條更明顯。' },
      { type: 'quote', text: '教練的胸部訓練特別建議\n\n新手練胸常說「沒感覺」，這裡給你一個小秘訣：「挺胸，但不拱腰」。在推的過程中，你要想像有人在後面推你的胸口，讓你的胸部永遠保持在最前方。當你的胸部比肩膀還前面的時候，發力感就會瞬間變強！\n\n如果練完胸後手臂後側(三頭肌)比較酸，那是正常的，因為它們是輔助。但如果只有手臂酸，請把重量調輕一點，專注在「擠壓胸部」的感覺上。' }
    ]
  },
  {
    id: 'ch3-2-shoulders',
    title: '3-2：動作指導 —— 肩部主題 (Shoulders)',
    subtitle: '打造立體虎頭肩',
    readTime: '4 min',
    content: [
      { type: 'quote', text: '教練的話：「肩膀是身體的『衣架子』，也是最靈活也最脆弱的關節。新手練肩不要急著衝重量，要把動作做『圓』。想像你的肩膀是一顆球，我們要從三個方向把它灌飽，才能練出立體的虎頭肩！」' },
      { type: 'section', title: '為什麼要練肩？(部位效果對比)' },
      { type: 'text', text: '肩膀（三角肌）分為前、中、後三塊，它們帶來的視覺與生理效果截然不同：' },
      { type: 'card', title: '前三角肌', content: '視覺效果：銜接胸肌，讓正面看起來厚實。\n對身體的影響：提升所有「推」的動作力量。\n比喻：引擎的推力' },
      { type: 'card', title: '中三角肌', content: '視覺效果：視覺變寬的關鍵！撐開肩線。\n對身體的影響：增加手臂外展的穩定性。\n比喻：衣架的寬度' },
      { type: 'card', title: '後三角肌', content: '視覺效果：打造3D立體感，改善側面單薄。\n對身體的影響：修正圓肩、保護肩關節健康。\n比喻：體態的拉緊' },
      { type: 'section', title: '1. 整體推力基礎：機械式肩推 (Machine Overhead Press)' },
      { type: 'text', text: '這是建立肩部基礎力量的首選，能同時練到前束與中束，安全性極高。\n\n1. 主要訓練肌群：三角肌前束、中束、三頭肌。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 設定：調整座椅，讓握把起始位置約在耳朵高度。\n○ 固定：背部貼緊椅背，核心收緊，雙腳踩實。\n○ 發力：呼氣垂直向上推，手肘不鎖死。下降時控制速度，不要讓重量重重撞擊。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 過度挺腰：因為太重而用下背去頂，這會傷到脊椎。\n○ 聳肩：用脖子出力，導致練完肩膀沒感覺，脖子卻很痛。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3-4組 × 8-12次(休息90秒)。\n○ 想變更強(最大力量)：3-5組 × 5-8次(休息3分鐘)。\n○ 想練線條(肌耐力)：2-3組 × 15-20次(休息45秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：啞鈴坐姿肩推、史密斯機肩推。\n\n7. 具體影響：這是提升整體上舉力量、增加肩膀「厚度」的王牌動作。' },
      { type: 'section', title: '2. 變寬祕訣：啞鈴側平舉 (Dumbbell Lateral Raise)' },
      { type: 'text', text: '如果你想改善窄肩，這就是最重要的動作。它專門針對「中束」，是視覺加寬的唯一途徑。\n\n1. 主要訓練肌群：三角肌中束。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 預備：雙手各拿輕啞鈴(新手建議先拿最輕的)，身體微前傾。\n○ 發力：想像「手肘」往兩側帶，把啞鈴抬到與肩膀同高，手肘維持微彎。\n○ 感受：想像在倒水，小拇指稍微朝上，感受肩膀外側的燃燒感。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 身體晃動：靠甩動身體把重量甩上去(那是練腰不是練肩)。\n○ 抬太高：抬超過肩膀高度會讓斜方肌(脖子旁)過度代償。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 12-15次(休息60秒)。\n○ 想變更強(最大力量)：不建議以此動作練低次數力量，容易受傷。\n○ 想練線條(肌耐力)：3組 × 20次(休息30秒)。\n\n5. 建議一週頻率：每週2-3次(中束恢復快，可多練)。\n\n6. 可替代動作：滑輪側平舉(Cable Lateral Raise)。\n\n7. 具體影響：刻畫肩膀外側線條，讓你的「肩膀變寬」，穿T恤不再撐不起來。' },
      { type: 'section', title: '3. 體態救星：機械反向飛鳥 (Machine Reverse Fly)' },
      { type: 'text', text: '針對新手最容易忽略的「後束」，這對於長期讀書導致圓肩的學生來說是「神級動作」。\n\n1. 主要訓練肌群：三角肌後束、上背部肌群。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 姿勢：反向坐在機械上(胸口貼墊子)，雙手平握握把。\n○ 發力：保持手肘微彎，用肩膀後方的力量將手臂往兩側撥開。\n○ 感受：感覺兩片肩胛骨在「後撥」，而不是在「夾」。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 聳肩：肩膀拱起，壓力全部跑到斜方肌。\n○ 握太緊：過度依賴小臂發力，導致後肩沒感覺。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 12-15次(休息60秒)。\n○ 想變更強(最大力量)：不建議此動作衝大重量。\n○ 想練線條(肌耐力)：3組 × 20次(休息30秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：繩索面拉(Face Pull)、啞鈴俯身飛鳥。\n\n7. 具體影響：消除「含胸駝背」，讓肩膀從側面看更飽滿，呈現3D立體視覺。' },
      { type: 'quote', text: '教練的肩部訓練特別建議\n\n肩膀的肌肉很小，新手最忌諱「重量太重」。如果你在做側平舉或肩推時感覺脖子很緊，請立刻減輕重量。一個小秘訣：在動作過程中，舌頭頂住上顎，這能幫你放鬆脖子前側肌肉，讓發力更集中在肩膀。\n\n另外，肩膀後束(第3點)雖然看不見，但它是決定你體態「有沒有質感」的關鍵。練胸之後一定要練後肩，這叫「平衡」，否則你只會越練越駝背！' }
    ]
  },
  {
    id: 'ch3-3-back',
    title: '3-3：動作指導 —— 背部主題 (Back)',
    subtitle: '隱形引擎與倒三角',
    readTime: '4 min',
    content: [
      { type: 'quote', text: '教練的話：「背部是身體的『隱形引擎』。雖然照鏡子很難直接看到，但它決定了你走路是否有精神、穿衣服是否有厚度。對於長期低頭讀書的你，練背就是最強的『體態矯正器』，讓我們把這扇寬闊的背牆築起來！」' },
      { type: 'section', title: '為什麼要練背？(訓練優點)' },
      { type: 'text', text: '• 視覺效果：背部訓練能打造出經典的「倒三角」身材(V-Taper)。當背闊肌變寬，你的腰部會在視覺上顯得更細，讓身材比例更完美。\n• 體態修正：長期讀書容易導致「圓肩」與「駝背」。強壯的背部肌肉能像拉緊器一樣，將你的肩膀往後、往下帶，讓你的脊椎自然挺直，整個人看起來更有自信。\n• 身體影響：背部肌群負責所有的「拉」動作。練好背部能支撐你的脊椎，減少腰痠背痛，並提升搬重物時的安全性。' },
      { type: 'section', title: '1. 寬度之王：滑輪下拉 (Lat Pulldown)' },
      { type: 'text', text: '這是新手增加背部寬度最有效的動作，難度比引體向上低很多，容易掌握背部發力。\n\n1. 主要訓練肌群：背闊肌(決定背部寬度)。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 預備：雙手握距比肩寬，坐穩後膝蓋卡在墊子下。\n○ 發力：想像「手肘」往身體兩側下方帶，將握把下拉至上胸處。\n○ 感受：下拉時挺胸，感受腋下後方的肌肉在收縮。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 用手硬拉：過度使用二頭肌，導致手很酸但背沒感覺。\n○ 身體晃動：靠後仰的慣性把重量甩下來。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3-4組 × 8-12次(休息90秒)。\n○ 想變更強(最大力量)：3-5組 × 5-8次(休息3分鐘)。\n○ 想練線條(肌耐力)：2-3組 × 15-20次(休息45秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：輔助引體向上機、彈力帶下拉。\n\n7. 具體影響：讓你的背部向橫向發展，穿西裝或襯衫時能撐開肩線。' },
      { type: 'section', title: '2. 厚度首選：坐姿划船 (Seated Row)' },
      { type: 'text', text: '這個動作能增加背部的層次感，讓背部看起來更有力量，對於修正體態效果最好。\n\n1. 主要訓練肌群：菱形肌、中下斜方肌(決定背部厚度與層次)。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 姿勢：坐在機械上，雙腳踩穩，膝蓋微彎。\n○ 發力：肩膀先向後夾，接著手肘往後拉到腰際。\n○ 擠壓：想像兩片肩胛骨要互碰，停留1秒感受背部中間的擠壓感。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 聳肩划船：肩膀拱起，壓力全部跑到脖子旁的斜方肌。\n○ 圓背操作：在拉的過程中背部彎曲，這會給腰椎極大壓力。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 10-12次(休息90秒)。\n○ 想變更強(最大力量)：3組 × 6-8次(休息3分鐘)。\n○ 想練線條(肌耐力)：3組 × 15-20次(休息45秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：啞鈴單臂划船、機械划船。\n\n7. 具體影響：提升脊椎穩定性，加強背部中心深度，讓側面看過去身型更厚實。' },
      { type: 'section', title: '3. 單側平衡：單臂啞鈴划船 (One-arm Dumbbell Row)' },
      { type: 'text', text: '這是一個自由重量動作，能獨立訓練每一側的背部，解決左右力量不均的問題。\n\n1. 主要訓練肌群：背闊肌、大圓肌、核心穩定。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 撐體：一手扶在啞鈴架或長椅上，身體與地面接近平行。\n○ 軌跡：啞鈴往「屁股/髖部」的方向拉，而不是往胸口拉。\n○ 核心：整個過程中身體不要隨意旋轉，保持背部平直。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 旋轉軀幹：靠轉動身體來借力，這會降低背部的參與度。\n○ 拉太高：手肘拉超過身體平面太多，會造成肩關節前側不適。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 10-12次(休息90秒)。\n○ 想變更強(最大力量)：3組 × 8次(休息2分鐘)。\n○ 想練線條(肌耐力)：3組 × 15次(休息60秒)。\n\n5. 建議一週頻率：每週1-2次。\n\n6. 可替代動作：機械式單臂划船。\n\n7. 具體影響：強化核心穩定性，並精細刻畫背部單側的線條與平衡感。' },
      { type: 'quote', text: '教練的背部訓練特別建議\n\n背部訓練對新手來說最難的是「感覺不到背」。請記住這句口訣：「手只是勾子，手肘是發動機。」在做任何拉的動作時，不要想着用手指用力抓把手，你要想像你的力氣是從「手肘」往後頂出去的。\n\n另外，練背時一定要「挺胸」。如果你縮著胸部練背，你的背肌永遠無法完全收縮。這對於長期低頭讀書的你來說，剛好是一個強迫自己挺拔起來的好機會！' }
    ]
  },
  {
    id: 'ch3-4-arms',
    title: '3-4：動作指導 —— 手臂主題 (Arms)',
    subtitle: '穿衣顯壯的關鍵',
    readTime: '3 min',
    content: [
      { type: 'quote', text: '教練的話：「手臂是你的名片。當你穿上短袖，粗壯的手臂就是你自律的最佳證明。新手練手臂不要只會瘋狂彎舉，我們要聰明地分配比例。記住：想讓手臂變粗，三頭肌比二頭肌更重要！」' },
      { type: 'section', title: '為什麼要練手臂？(部位效果對比)' },
      { type: 'text', text: '手臂主要由前側的二頭肌與後側的三頭肌組成，它們對視覺的貢獻完全不同：' },
      { type: 'card', title: '二頭肌 (Biceps)', content: '視覺效果：隆起的「山峰」，展現力量感。\n對身體的影響：輔助所有的「拉」動作(如划船)。\n比喻：引擎的拉桿' },
      { type: 'card', title: '三頭肌 (Triceps)', content: '視覺效果：手臂體積的2/3！決定手臂粗細。\n對身體的影響：輔助所有的「推」動作(如胸推)。\n比喻：穩定的地基' },
      { type: 'section', title: '1. 二頭肌經典：啞鈴彎舉 (Dumbbell Curl)' },
      { type: 'text', text: '這是練習二頭肌最基礎也最有效的動作，能獨立訓練左右手的控制力。\n\n1. 主要訓練肌群：肱二頭肌。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 站姿：雙腳與肩同寬，手肘微彎固定在身體兩側。\n○ 旋轉：往上舉時，掌心向上轉，感受二頭肌頂峰的收縮。\n○ 控制：下放時要慢，不要直接垂下去，維持肌肉張力。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 身體晃動：靠甩腰的力量把啞鈴盪上去(代償)。\n○ 手肘前移：手肘離開身體兩側，壓力會跑到前肩。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 8-12次(休息60-90秒)。\n○ 想變更強(最大力量)：3組 × 6-8次(休息2分鐘)。\n○ 想練線條(肌耐力)：2-3組 × 15-20次(休息30-45秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：槓鈴彎舉、機械彎舉機。\n\n7. 具體影響：刻畫手臂前側線條，讓你的「手臂山峰」更明顯。' },
      { type: 'section', title: '2. 三頭肌首選：滑輪三頭壓低 (Cable Pushdown)' },
      { type: 'text', text: '這是新手感受度最高的手臂動作，安全性高且能精準刺激手臂後側。\n\n1. 主要訓練肌群：肱三頭肌(手臂粗細的關鍵)。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 姿勢：面對滑輪，雙手握住桿子或繩索，挺胸收腹。\n○ 鎖定：手肘像被釘子釘在身體兩側，只有前臂移動。\n○ 壓底：呼氣往下壓到底，感覺手臂後側完全收緊。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 聳肩：肩膀用力去壓重量。\n○ 手肘亂動：手肘前後晃動，這會變成在練背。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3-4組 × 10-15次(休息60秒)。\n○ 想變更強(最大力量)：3組 × 8次(休息90秒)。\n○ 想練線條(肌耐力)：3組 × 20次(休息30秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：啞鈴後撐(Kickback)、長椅撐體(Dips)。\n\n7. 具體影響：填補手臂後方的空間，讓手臂從側面看厚度十足。' },
      { type: 'section', title: '3. 寬度加強：啞鈴錘式彎舉 (Hammer Curl)' },
      { type: 'text', text: '這個動作能練到側面的肌肉(肱肌)，讓你的手臂從「正面」看起來變寬。\n\n1. 主要訓練肌群：肱肌、肱桡肌(前臂)。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 握法：掌心相對(像拿錘子一樣)。\n○ 發力：垂直往上彎舉。\n○ 功能：這個動作同時能強化你的握力，對以後拉重物很有幫助。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 握太緊：過度依賴手指力量，導致手掌抽筋。\n○ 下放不完全：動作範圍太小。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 10-12次(休息60秒)。\n○ 想變更強(最大力量)：3組 × 8次(休息90秒)。\n○ 想練線條(肌耐力)：2組 × 15次(休息45秒)。\n\n5. 建議一週頻率：每週1次(可接在二頭彎舉後做)。\n\n6. 可替代動作：繩索錘式彎舉。\n\n7. 具體影響：增加手臂的「正面寬度」，讓手臂結構更立體。' },
      { type: 'quote', text: '教練的手臂訓練特別建議\n\n新手最容易犯的錯就是「每天都在練手臂」。手臂是小肌群，它在練胸、練背的時候已經參與了很多輔助。如果你每天練，肌肉沒時間修復，反而長不大。\n\n教練的「手臂長大」黃金法則：如果你今天練了胸，最後補1-2個三頭肌動作；如果你今天練了背，最後補1-2個二頭肌動作。這種「大帶小」的訓練法，才是新手進步最快的方式！\n\n最後提醒，練手臂時請保持手腕中立(不要過度勾手或垂手)，這能保護你的腕關節，避免練完手臂結果手腕痛。' }
    ]
  },
  {
    id: 'ch3-5-glutes',
    title: '3-5：動作指導 —— 臀部主題 (Glutes)',
    subtitle: '喚醒身體最大引擎',
    readTime: '4 min',
    content: [
      { type: 'quote', text: '教練的話：「很多新手以為練臀是女生的專利，大錯特錯！臀部是全身力量最強、體積最大的肌群。練好臀部，你的深蹲會更穩、走路會更有力，最重要的是——你的腰痛會消失。我們要把這塊『懶惰的肌肉』重新喚醒！」' },
      { type: 'section', title: '為什麼要練臀？(部位效果對比)' },
      { type: 'text', text: '臀部主要由大、中、小三角肌組成(這與肩膀的邏輯很像)，視覺與功能重點如下：' },
      { type: 'card', title: '大臀肌 (Gluteus Maximus)', content: '視覺效果：決定臀部「厚度」與翹度。\n對身體的影響：身體爆發力的來源，保護下背與腰椎。\n比喻：引擎的活塞' },
      { type: 'card', title: '中/小臀肌 (Gluteus Medius)', content: '視覺效果：決定臀部「兩側線條」。\n對身體的影響：走路與單腳站立的穩定器，預防膝蓋受傷。\n比喻：避震系統' },
      { type: 'section', title: '1. 臀部王牌：機械式臀推 (Machine Hip Thrust)' },
      { type: 'text', text: '如果健身房有這台器材，請務必排進去。它是針對「大臀肌」最直接、感受度最高的動作。\n\n1. 主要訓練肌群：大臀肌。為什麼重要？它是維持體態挺拔、增加臀部高度的關鍵。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 設定：背部靠在墊子上(約在肩胛骨下緣)，腳掌踩實地板。\n○ 發力：呼氣，屁股用力往天花板推，直到身體從肩到膝蓋呈一直線。\n○ 鎖定：頂峰時用力擠壓屁股1秒，想像屁股夾著一張百元大鈔。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 過度拱腰：為了推更高而讓腰部懸空，這會導致腰酸。\n○ 腳跟離地：重心偏前，會讓大腿前側出力過多，屁股沒感覺。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3-4組 × 10-12次(休息90秒)。\n○ 想變更強(最大力量)：3-5組 × 5-8次(休息3分鐘)。\n○ 想練線條(肌耐力)：2-3組 × 15-20次(休息45秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：啞鈴臀橋(Glute Bridge)、史密斯機臀推。\n\n7. 具體影響：讓屁股從側面看「變厚、變翹」，填補褲子後方的空隙。' },
      { type: 'section', title: '2. 髖部鉸鏈基礎：羅馬尼亞硬舉 (RDL)' },
      { type: 'text', text: '這是新手學習「正確使用屁股」的必經之路，也是保護脊椎、建立正確發力模式的關鍵。\n\n1. 主要訓練肌群：大臀肌、腿後肌群(Hamstrings)。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 口訣：想像你雙手拿著重物，要用屁股去「關上後面的門」。\n○ 軌跡：啞鈴貼著大腿往下溜，重心在腳跟，感受到屁股被「拉長」。\n○ 收縮：到達極限後，夾緊屁股站起來，不要用腰硬拉。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 圓背：背部彎曲像蝦子，這是受傷的高風險區。\n○ 蹲得太深：這不是深蹲，膝蓋只要微彎，重點是屁股往後推。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 8-12次(休息90秒)。\n○ 想變更強(最大力量)：3組 × 6-8次(休息3分鐘)。\n○ 想練線條(肌耐力)：3組 × 15次(休息60秒)。\n\n5. 建議一週頻率：每週1次(對神經系統消耗較大)。\n\n6. 可替代動作：壺鈴擺盪(Kettlebell Swing)。\n\n7. 具體影響：強化「臀腿線」交界處，讓腿部線條看起來更修長、緊實。' },
      { type: 'section', title: '3. 兩側線條：坐姿髖外展 (Seated Hip Abduction)' },
      { type: 'text', text: '針對臀部「兩側」的小肌肉，這能幫你解決「臀部凹陷」的問題，讓身形更圓潤。\n\n1. 主要訓練肌群：中三角肌、小三角肌。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 姿勢：坐在機械上，背部挺直(進階者可稍微前傾增加感受)。\n○ 發力：雙膝用力往外撐開，感受屁股兩側的酸痛感。\n○ 控制：放回來時要慢，不要讓重量直接撞擊。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 身體縮起來：核心沒力導致身體扭曲。\n○ 靠慣性甩：動作太快，肌肉完全沒受力。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 12-15次(休息60秒)。\n○ 想變更強(最大力量)：此動作不建議做低次數力量訓練。\n○ 想練線條(肌耐力)：3組 × 20次(休息30秒)。\n\n5. 建議一週頻率：每週2-3次。\n\n6. 可替代動作：側躺抬腿、彈力帶橫移(螃蟹走)。\n\n7. 具體影響：填補臀部兩側的空洞，讓穿牛仔褲時的側面弧度更完美。' },
      { type: 'quote', text: '教練的臀部訓練特別建議\n\n新手練臀最容易遇到「屁股沒感覺，腿很酸」。這通常是因為你的「臀肌在睡覺」。教練的「喚醒」秘訣：在訓練前，先做2組徒手的「橋式」，在最高點用力夾屁股5秒。這會先告訴大腦：「嘿！等一下要用這裡出力喔！」\n\n另外，練臀時下巴一定要收好。不要抬頭看鏡子，眼睛直視前方或稍微偏下。收下巴能幫你鎖定脊椎，預防腰部代償。\n\n如果你練完臀部隔天，發現下樓梯很困難，那代表你練對了！恭喜你，你的引擎正在升級中！' }
    ]
  },
  {
    id: 'ch3-6-legs',
    title: '3-6：動作指導 —— 腿部主題 (Legs)',
    subtitle: '投資報酬率最高的部位',
    readTime: '4 min',
    content: [
      { type: 'quote', text: '教練的話：「練腿很痛苦，但它是健身房裡回報率最高的投資。腿部佔了全身將近一半的肌肉量，練好腿就像幫你的身體換了一顆大馬力的引擎。別再當『跳過腿日』的人了，挺拔的身材必須要有穩固的地基！」' },
      { type: 'section', title: '為什麼要練腿？(部位效果對比)' },
      { type: 'text', text: '腿部肌群非常複雜，主要由前側、後側與下端的肌肉組成，其視覺與功能效果如下：' },
      { type: 'card', title: '股四頭肌 (Quads)', content: '視覺效果：決定大腿前側的厚度與線條。\n對身體的影響：負責走、跑、跳的核心力量，支撐膝關節。\n比喻：引擎的傳動軸' },
      { type: 'card', title: '腿後肌群 (Hamstrings)', content: '視覺效果：決定大腿側面與後側的深度。\n對身體的影響：預防運動傷害，與臀部共同負責推進力。\n比喻：煞車與穩定系統' },
      { type: 'card', title: '小腿肌 (Calves)', content: '視覺效果：展現精實與力量感，視覺更協調。\n對身體的影響：腳踝的穩定器，日常生活最常用的肌肉。\n比喻：避震器的彈簧' },
      { type: 'section', title: '1. 腿部基礎：機械推腿 (Machine Leg Press)' },
      { type: 'text', text: '對於新手來說，這是建立大腿力量最安全、最高效的起點，不需要擔心平衡問題。\n\n1. 主要訓練肌群：股四頭肌、大臀肌。為什麼重要？它能讓你一次訓練到下半身所有的大肌肉。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 設定：坐在椅子上，雙腳與肩同寬踩在踏板中央。\n○ 發力：呼氣，用腳掌中心發力將踏板推開。\n○ 控制：放回來時要慢，膝蓋不要內夾，對準腳尖方向。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 膝蓋完全鎖死：推到底時腳打得太直，會讓關節承受過大壓力(極度危險！)。\n○ 屁股離開椅墊：為了推更重而讓下背懸空，容易傷到腰椎。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3-4組 × 8-12次(休息90-120秒)。\n○ 想變更強(最大力量)：3-5組 × 5-8次(休息3分鐘)。\n○ 想練線條(肌耐力)：2-3組 × 15-20次(休息45秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：高杯深蹲(Goblet Squat)。\n\n7. 具體影響：快速增加下肢力量，讓你看起來不再弱不禁風。' },
      { type: 'section', title: '2. 前側刻畫：機械坐姿腿伸展 (Leg Extension)' },
      { type: 'text', text: '這是一個孤立動作，能讓你精準地感覺到大腿前側「燒起來」的快感。\n\n1. 主要訓練肌群：股四頭肌。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 設定：調整背靠，讓膝蓋轉軸對準機器的轉軸。\n○ 發力：雙腳向上踢，直到腿部完全伸直。\n○ 收縮：在最高點停留1秒，用力擠壓大腿前側。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 身體晃動：靠甩動身體來借力。\n○ 動作範圍太小：沒踢到底，肌肉沒有完全收縮。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 12-15次(休息60秒)。\n○ 想變更強(最大力量)：不建議以此動作衝最大重量。\n○ 想練線條(肌耐力)：3組 × 20次(休息30秒)。\n\n5. 建議一週頻率：每週1-2次。\n\n6. 可替代動作：彈力帶腿伸展。\n\n7. 具體影響：讓大腿前側線條分明，穿短褲時展現精悍的線條。' },
      { type: 'section', title: '3. 後側加強：臥姿/坐姿腿屈伸 (Leg Curl)' },
      { type: 'text', text: '針對大腿後側，這對於平衡腿部力量、預防膝蓋受傷極其重要。\n\n1. 主要訓練肌群：腿後肌群(Hamstrings)。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 姿勢：趴穩或坐穩，腳踝卡在墊子後方。\n○ 發力：想像把腳跟往屁股的方向拉，盡量勾到底。\n○ 控制：下放過程保持緩慢，感受肌肉被拉長的感覺。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 屁股浮起：用腰力代償，這會讓訓練效果減半。\n○ 用力過猛：動作太快導致小腿肌肉抽筋。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(肌肥大)：3組 × 10-12次(休息60-90秒)。\n○ 想變更強(最大力量)：3組 × 8次(休息2分鐘)。\n○ 想練線條(肌耐力)：3組 × 15次(休息45秒)。\n\n5. 建議一週頻率：每週1-2次。\n\n6. 可替代動作：啞鈴俯臥腿屈伸。\n\n7. 具體影響：增加大腿的立體感與支撐力，保護膝關節不外翻。' },
      { type: 'section', title: '4. 小腿修飾：站姿/坐姿提踵 (Calf Raise)' },
      { type: 'text', text: '最後別忘了小腿，這能讓你的全身比例看起來更協調。\n\n1. 主要訓練肌群：腓腸肌、比目魚肌。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 發力：用力踮起腳尖到最高點，停留1秒。\n○ 拉伸：緩慢下放，讓腳跟低於水平面，感受小腿徹底拉開。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 節奏太快：像在跳動一樣，這只是在利用筋膜彈性而非肌肉。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 線條與耐力：3組 × 15-20次(休息30秒)。\n\n5. 建議頻率：每週2-3次。' },
      { type: 'quote', text: '教練的腿部訓練特別建議\n\n練腿最怕「膝蓋痛」。請記住這句保命符：「膝蓋永遠跟著腳尖走。」如果你下蹲或推腿時，膝蓋不自覺往內縮，請減輕重量。膝蓋內夾是毀掉關節的第一步。\n\n另外，練腿當天的體力消耗會非常大。如果你是考研生，我建議把腿日安排在休息日的前一天。因為練完腿後，你的大腦可能會因為身體修復肌肉而感到疲倦，隔天排輕鬆一點的讀書進度或純粹休息，是維持長期計畫的小秘訣！' }
    ]
  },
  {
    id: 'ch3-7-core',
    title: '3-7：動作指導 —— 核心主題 (Core)',
    subtitle: '天然護腰',
    readTime: '3 min',
    content: [
      { type: 'quote', text: '教練的話：「很多人以為練核心就是為了那六塊肌，但對我來說，核心是你的『天然護腰』。無論你是要舉起更重的槓鈴，還是要坐著讀書一整天，核心的穩定度決定了你的下背會不會痛。我們不只要練表面，更要練深層！」' },
      { type: 'section', title: '為什麼要練核心？(部位效果對比)' },
      { type: 'text', text: '核心肌群是一個環繞軀幹的立體結構，不同部位的功能如下：' },
      { type: 'card', title: '前側 (腹直肌)', content: '視覺效果：視覺上的「六塊肌」線條。\n對身體的影響：負責軀幹前彎，穩定腹壓。\n比喻：城牆的正面' },
      { type: 'card', title: '側向 (斜肌)', content: '視覺效果：兩側的「人魚線」或「鯊魚線」。\n對身體的影響：負責旋轉與側彎，增加軀幹抗旋轉能力。\n比喻：側邊的支柱' },
      { type: 'card', title: '深層 (腹橫肌)', content: '視覺效果：讓小腹看起來更平坦、腰圍更緊。\n對身體的影響：真正的護腰，維持脊椎中立與腹壓穩定。\n比喻：內層的塑身衣' },
      { type: 'section', title: '1. 深層穩定基礎：死蟲式 (Deadbug)' },
      { type: 'text', text: '這是所有新手進健身房最該學的第一個核心動作，它教你如何在手腳移動時，保持脊椎穩定不動。\n\n1. 主要訓練肌群：腹橫肌(深層核心)、腹直肌。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 預備：平躺在地，雙手舉向天花板，雙膝彎曲90度舉起。\n○ 核心鎖定：最重要的一步！想像有人要踩你的肚子，用力縮腹，讓下背部死死貼住地面(不能有縫隙)。\n○ 發力：緩慢地將對側的手與腳向外延伸，同時維持下背貼地。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 腰部浮起：這代表核心失去控制，受力會跑到腰椎，導致練完腰酸。\n○ 動作太快：這是訓練穩定，越慢效果越好。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(增加厚度)：3組 × 每邊10-12次(休息60秒)。\n○ 想變更強(穩定性)：3組 × 緩慢執行每邊8次(休息90秒)。\n○ 想練線條(肌耐力)：3組 × 每邊15-20次(休息30秒)。\n\n5. 建議一週頻率：每週3-4次(可作為訓練前的啟動)。\n\n6. 可替代動作：鳥狗式(Bird Dog)。\n\n7. 具體影響：建立強大的腹壓控制力，預防深蹲時的腰部受傷。' },
      { type: 'section', title: '2. 靜態剛性訓練：棒式 (Plank)' },
      { type: 'text', text: '棒式不是看誰撐得久，而是看誰撐得「緊」。它是訓練全身協同抗重力的王牌動作。\n\n1. 主要訓練肌群：全核心肌群、肩膀、臀部。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 姿勢：手肘在肩膀正下方，腳尖踩地。\n○ 全身發力：想像要把地板「往後拉」，同時夾緊屁股、繃緊大腿。\n○ 成一直線：身體從頭到腳跟要像一塊堅硬的木板。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 屁股太高或下墜：這會讓核心失效，壓力轉移到肩膀或腰部。\n○ 抬頭看前方：頸椎壓力過大，眼睛應看地板。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 核心剛性：3組 × 撐30-45秒(休息60秒)。\n教練叮嚀：如果能撐超過1分鐘，請增加難度(如單腳撐)，而不是無限延長時間。\n\n5. 建議一週頻率：每週2-3次。\n\n6. 可替代動作：側棒式(Side Plank)。\n\n7. 具體影響：提高軀幹的抗壓能力，改善日常站姿與坐姿。' },
      { type: 'section', title: '3. 下腹刻畫：垂直提膝 (Captain\'s Chair Knee Raise)' },
      { type: 'text', text: '這是健身房常見器材，專門針對難練的「下腹部」。\n\n1. 主要訓練肌群：腹直肌下半部。' },
      { type: 'highlight', title: '2. 動作執行重點', text: '○ 固定：雙手撐在架子上，背部貼緊靠墊，肩膀放鬆不要聳肩。\n○ 發力：想像把「膝蓋往胸口帶」，並在最高點稍微「捲動屁股」。\n○ 控制：放下去時要慢，不要讓腳自然垂落。' },
      { type: 'highlight', title: '3. 新手最常犯的錯誤', text: '○ 靠慣性甩動：身體前後晃動，這是在練髖屈肌而非腹肌。\n○ 只有動大腿：骨盆沒有跟著捲動，腹肌收縮會不完全。' },
      { type: 'text', text: '4. 組數×次數×休息建議：\n○ 想變更壯(腹肌立體)：3組 × 12次(休息60秒)。\n○ 想練線條(人魚線)：3組 × 20次(休息45秒)。\n\n5. 建議一週頻率：每週2次。\n\n6. 可替代動作：臥姿抬腿(Lying Leg Raise)。\n\n7. 具體影響：緊實小腹，強化下腹部線條。' },
      { type: 'quote', text: '教練的核心訓練特別建議\n\n新手最常問我：「教練，為什麼我練那麼多腹肌，還是看不到六塊肌？」教練的真心話：核心線條是「練出來的」，但能不能「看見」取決於你的體脂肪。如果你體脂很高，腹肌會被埋在脂肪下。但是！這不代表不用練核心。一個強大的核心能讓你在做胸推、深蹲時更穩，從而讓你舉得更重、消耗更多熱量，這才是瘦下來看到腹肌的正確路徑。\n\n最後，練核心時千萬不要憋氣。學會「帶著腹壓呼吸」(想像肚子維持硬度，但照樣能短促呼吸)，這能讓你的核心肌肉訓練效果翻倍！' }
    ]
  },
  {
    id: 'ch4-diet',
    title: '第四章：飲食與修復',
    subtitle: '體態改變的真正關鍵',
    readTime: '5 min',
    content: [
      { type: 'quote', text: '教練的話：「請記住，這章節是你健身計畫中最重要的核心。健身界有句名言：『肌肉是在休息時長的，不是在練的時候長的。』如果你只練卻不吃、不睡，你只是在消耗你的身體，而不是改造它。這章要教你如何用『手掌』當秤、用『AI』當助手，並透過睡眠鎖定你的進步，讓你事半功倍！」' },
      { type: 'highlight', title: '教練的心理強心針：飲食不是「開關」，而是「旋鈕」', text: '在進入細節前，我要先幫你卸下壓力。很多新手會問：「教練，如果我今天聚餐吃錯了，是不是前面都白練了？」\n\n答案是：絕對不會。\n\n請記住：飲食不是「開關」，按下去就全有或全無；飲食是一個「旋鈕」。\n\n• 當你今天吃得很精準，旋鈕轉到100%，效果當然最好。\n\n• 當你今天跟朋友聚餐、吃了炸雞，旋鈕只是轉到了40%。你的進步會慢一點，但絕對不會歸零。\n\n只要你還在訓練，你的身體就在建造肌肉這台「燃脂機器」。就算吃得不完美，訓練依然有效。不要因為一頓飯的不完美，就氣得把整個旋鈕拔掉（放棄計畫）。我們追求的是「長期的平均值」，而不是每一餐的完美。' },
      { type: 'section', title: '一、認識你的能量指南：TDEE 是什麼？' },
      { type: 'text', text: '在開始吃之前，你要先知道你的身體每天需要多少能量。\n\n• BMR (基礎代謝率)：你躺著不動，身體維持生命所需的最低熱量。\n\n• TDEE (總日消耗熱量)：BMR + 你的日常活動 + 運動消耗。\n\n○ 簡單理解：TDEE就是你的「熱量平衡點」。\n○ 吃 > TDEE：體重增加（增肌）。\n○ 吃 < TDEE：體重減少（減脂）。\n○ 吃 = TDEE：維持現狀（體態重組）。\n\n教練建議：上網搜尋「TDEE計算機」，輸入身高體重，算出那個數字。我們不需要精確到1大卡，只需要知道個大概。' },
      { type: 'section', title: '二、三種目標的飲食策略' },
      { type: 'text', text: '請根據你目前的體態與目標選擇方案：' },
      { type: 'card', title: '1. 想變壯 (增肌)', content: '• 飲食邏輯：熱量盈餘\n• 具體做法：吃進去的熱量 = TDEE + 200~300大卡' },
      { type: 'card', title: '2. 想變瘦 (減脂)', content: '• 飲食邏輯：熱量赤字\n• 具體做法：吃進去的熱量 = TDEE - 300~500大卡' },
      { type: 'card', title: '3. 想練線條 (維持)', content: '• 飲食邏輯：熱量平衡\n• 具體做法：吃進去的熱量 = TDEE。維持訓練，肌肉會取代脂肪。' },
      { type: 'section', title: '三、手掌估算法：你的手就是最準的秤' },
      { type: 'text', text: '不需要電子秤，利用你的手掌大小，就能搞定每一餐的比例。' },
      { type: 'list', items: [
        '1. 蛋白質 (肉/魚/蛋)：一個手掌。\n○ 包含厚度與長度。每餐 1-2 個手掌。',
        '2. 碳水化合物 (飯/麵/地瓜)：一個拳頭。\n○ 增肌期可以到 1.5 個拳頭；減脂期減少到半個拳頭。',
        '3. 蔬菜 (各類纖維)：一個拳頭。\n○ 減脂期建議每餐至少 2 個拳頭，增加飽足感。',
        '4. 脂肪 (油脂/堅果)：一個大拇指。\n○ 烹調用油或堅果，每餐約 1 個大拇指量。'
      ]},
      { type: 'section', title: '四、AI 助攻：如何拍照讓 AI 幫你算熱量？' },
      { type: 'text', text: '現在是 AI 時代，你不需要手動查熱量表。你可以利用像 Gemini 或其他 AI 助手，透過照片直接獲得估計值。\n\n拍照撇步 (讓AI看得更準)：\n1. 俯瞰視角：垂直對著食物拍，讓AI看到全貌。\n2. 參照物：旁邊可以放一支筆或手掌，讓AI判斷食物的比例大小。\n3. 描述細節：拍照後，附上一句話，例如：「這是一盤排骨飯，排骨是炸過的，飯量大約一個半拳頭。」\n\n給 AI 的提示詞(Prompt)範例：\n「請幫我分析這張照片中的食物。估算每樣食材的重量、蛋白質、脂肪、碳水化合物以及總熱量。最後告訴我這餐適合『增肌』還是『減脂』的人吃？」' },
      { type: 'section', title: '五、睡眠管理：身體真正的升級時間' },
      { type: 'text', text: '如果飲食是燃料，睡眠就是你的「系統更新」。\n\n1. 肌肉修復的黃金期：當你睡覺時，身體會分泌生長激素。如果你睡不夠，練再辛苦肌肉也不會長。\n2. 皮質醇控制：熬夜會讓壓力荷爾蒙(皮質醇)飆升，這會導致身體瘋狂儲存脂肪，並分解你的肌肉。\n3. 給新手的睡眠建議：\n○ 量：每天睡滿 7-9 小時。\n○ 質：睡前 30 分鐘不要滑手機(藍光會干擾睡眠)。\n○ 規律：固定的入睡時間對身體修復最有效。' },
      { type: 'section', title: '六、新手飲食避坑指南 (教練真心話)' },
      { type: 'list', items: [
        '1. 不要吃太少：減脂期如果吃低於 BMR，身體會以為你在鬧飢荒，導致代謝下降，最後越減越肥。',
        '2. 蛋白質迷思：新手不需要追求高難度的蛋白質攝取。只要掌握「每餐都有手掌大的肉」，加上重訓，肌肉一定會長。',
        '3. 水分的重要性：肌肉有 70% 是水。水分不足，訓練表現會下滑，肌肉看起來也會乾癟。',
        '4. 心理防線：偶爾的社交聚餐不是罪過。「只要還在桌上，就沒有輸」，吃完快樂餐，下一餐回到正軌即可。'
      ]},
      { type: 'text', text: '彈性原則：一週可以安排1-2餐「快樂餐」，這能幫你維持心理健康，讓健身計畫走得更遠。' }
    ]
  },
  {
    id: 'ch5-plans',
    title: '第五章：實戰派菜單 (基礎菜單)',
    subtitle: '選對你的進化之路',
    readTime: '3 min',
    content: [
      { type: 'quote', text: '教練的話：「菜單不是死的，它是你的『訓練地圖』。這章我針對三種最常見的需求，規劃了基礎版與三天一循環的加強版。請記住：『最好的菜單，是你能堅持下去的那一個。』」' },
      { type: 'section', title: '四周循環邏輯 (The 4-Week Progression)' },
      { type: 'text', text: '無論你選擇哪一套菜單，請遵循這套「科學進步規律」：\n\n• 第一週：技術學習週。使用最輕重量，RPE 控制在5-6。\n• 第二週：穩定增長週。開始加重，RPE 達到7-8。\n• 第三週：極限挑戰週。嘗試增加次數或重量，RPE達到8-9。\n• 第四週：減載恢復週(Deload)。重量/組數減半，讓神經系統休息，準備下一循環。\n\nfor新手：\n• 第1-4週：熟悉動作、不追重量\n• 第5-8週：穩定進步、建立節奏\n• 第9-12週：開始微調目標' },
      { type: 'section', title: '方案 A：【女神 S 曲線養成計畫】' },
      { type: 'text', text: '核心目標：緊緻線條、翹臀、改善含胸駝背。\n\n基礎版 (每週 3 天固定計畫)\n適合時間有限，想維持基本運動習慣的新手。\n• Day 1: 下肢與臀部核心 — 高杯深蹲、羅馬尼亞硬舉(RDL)、坐姿髖外展、死蟲式\n• Day 2: 上肢美化與背部 — 滑輪下拉、機械肩推、蝴蝶機、棒式\n• Day 3: 全身雕塑基礎 — 分腿蹲、坐姿划船、側平舉、三頭壓低\n\n加強版 (三天一循環: 美型滾動計畫)\n適合想要強化特定部位(如臀、肩)，且一週能練4-5天的人。\n• Day 1 (臀腿重點): 高杯蹲、RDL、髖外展、死蟲式。\n• Day 2 (背肩美化): 滑輪下拉、側平舉、反向飛鳥、棒式。\n• Day 3 (全身線條): 分腿蹲、機械胸推、三頭壓低、提踵。\n● 循環：練3天，休1天(或休2天)，重複循環。' },
      { type: 'section', title: '方案 B：【男神大肌群轟炸計畫】' },
      { type: 'text', text: '核心目標：增加肌肉體積、寬肩厚背、穿衣服有壓迫感。\n\n基礎版 (每週 4 天固定計畫)\n適合想要穩扎穩打，按部就班建立肌肉總量的男學員。\n• Day 1: 胸與推(胸/肩中束/三頭) — 機械胸推、啞鈴胸推、側平舉、三頭壓低\n• Day 2: 背與拉(背/二頭) — 滑輪下拉、坐姿划船、二頭彎舉、錘式彎舉\n• Day 3: 下肢地基(下半身/小腿) — 機械推腿、腿伸展、腿屈伸、提踵\n• Day 4: 肩部強化與核心 — 機械肩推、反向飛鳥、死蟲式、棒式\n\n加強版 (三天一循環: 拮抗與體積計畫)\n透過縮短部位循環週期，給予肌肉更密集的刺激。\n• Day 1 (胸背拮抗): 機械胸推+坐姿划船、啞鈴胸推+滑輪下拉(交替做)\n• Day 2 (肩臂擴張): 機械肩推、側平舉、二頭彎舉、三頭壓低、錘式彎舉\n• Day 3 (下肢地基): 機械推腿、腿伸展、腿屈伸、死蟲式\n● 循環：練3天，休1天，重複循環。' },
      { type: 'section', title: '方案 C：【鋼鐵之軀力量體格計畫】' },
      { type: 'text', text: '核心目標：全身性爆發力、功能性力量。\n\n基礎版 (每週 3 天全身性訓練)\n適合追求實用力量，想讓全身連結感變強的新手。\n• Day 1: 下肢推+上肢拉 — 機械推腿、滑輪下拉、死蟲式\n• Day 2: 下肢拉+上肢推 — 羅馬尼亞硬舉(RDL)、機械胸推、棒式\n• Day 3: 全身綜合基礎 — 高杯深蹲、機械肩推、坐姿划船、三頭壓低\n\n加強版 (三天一循環: 三大項強化計畫)\n專注於增加神經系統對「重重量」的適應。\n• Day 1 (推力主項): 機械推腿(重重量)、機械胸推(重重量)、側平舉、三頭壓低\n• Day 2 (拉力主項): 羅馬尼亞硬舉(重重量)、滑輪下拉、坐姿划船、核心穩定\n• Day 3 (爆發輔助): 高杯深蹲、機械肩推、二頭彎舉、死蟲式\n● 循環：練3天，休1-2天，重複循環。' },
      { type: 'section', title: '方案 D：【精煉 PPL 三天一循環計畫】' },
      { type: 'text', text: '核心目標：適合想要邏輯極其清晰、全身平衡發展的新手。\n\n基礎版 (推、拉、腿邏輯)\n• Day 1 (Push): 推(胸/肩/三頭) — 機械胸推、機械肩推、側平舉、三頭壓低\n• Day 2 (Pull): 拉(背/二頭) — 滑輪下拉、坐姿划船、二頭彎舉、錘式彎舉\n• Day 3 (Legs): 下肢與核心 — 機械推腿、腿屈伸、羅馬尼亞硬舉、死蟲式' },
      { type: 'section', title: '方案 E：【超低配・新手生存學習計畫】' },
      { type: 'text', text: '核心目標：克服健身焦慮、熟悉器材操作、建立初步肌肉控制。\n\n基礎版 (每週 2 天學習計畫)\n適合對健身房完全陌生，想以最安全、最低壓力開始的新手。\n• Day 1: 上半身基礎學習 — 機械胸推、滑輪下拉、機械肩推、死蟲式\n• Day 2: 下半身與核心基礎 — 機械推腿、腿伸展、腿屈伸、棒式\n\n加強版 (三天一循環: 全機械成長計畫)\n適合已熟悉操作，想透過全機械式器材增加力量的新手。\n• Day 1 (推與拉基礎): 機械胸推、滑輪下拉、側平舉、三頭壓低\n• Day 2 (下肢與核心): 機械推腿、腿屈伸、死蟲式、棒式\n• Day 3 (綜合進階學習): 高杯深蹲(嘗試自由重量)、坐姿划船、機械肩推、提踵\n● 循環：練3天，休2天，緩慢累積。' },
      { type: 'highlight', title: '教練的「菜單執行」小撇步', text: '1. 基礎與加強的切換：建議新手先跑 4-8 週的「基礎版」，等身體習慣痠痛、動作穩定後，再切換到「三天一循環加強版」。\n\n2. 記錄進度：無論哪個版本，都請記錄你的重量。如果這週做 10kg 輕輕鬆鬆，下週請加到 12kg。\n\n3. 聽從身體的聲音：加強版比較操，如果感覺關節痛或極度疲勞，請多休一天，不要強行推進。' }
    ]
  },
  {
    id: 'ch6-end',
    title: '第六章：結語',
    subtitle: '健身是一場與自己的馬拉松',
    readTime: '2 min',
    content: [
      { type: 'quote', text: '教練的話：「恭喜你讀完了這份指南！這代表你已經擁有了超過90%新手所欠缺的知識。但知識只是地圖，真正能帶你到達終點的，是你的雙腳。在你要踏入健身房之前，我想送給你最後的叮嚀。」' },
      { type: 'section', title: '為什麼有人會成功？(成功的特質)' },
      { type: 'list', items: [
        '1. 擁抱「平凡」的堅持：成功的人不是每天都充滿動力，而是在不想練的日子裡，依然換上衣服走進健身房。他們明白，每天進步1%的力量。',
        '2. 享受過程而非結果：他們不只愛看體重計上的數字，更愛看著鏡子裡動作越來越標準的自己，愛上那種流汗後大腦清醒的快感。',
        '3. 學會與身體對話：成功者知道什麼時候該衝，什麼時候該休。他們把健身當成一輩子的事，而不是為期三個月的任務。'
      ]},
      { type: 'section', title: '為什麼有人會失敗？(避開失敗的陷阱)' },
      { type: 'list', items: [
        '1. 追求「奇蹟」的速成心態：那些期待「練一週就有腹肌」的人最容易失敗。當現實不如預期，他們會立刻放棄。請記住，肌肉的生長是有生理週期的。',
        '2. 過度完美的極端計劃：很多人第一週就每天練兩小時、只吃雞胸肉。這種「爆衝」行為通常撐不過兩週。失敗往往源於自我要求太過苛刻，導致彈性疲乏。',
        '3. 不斷與他人比較：在社群軟體上看著別人的巔峰，來否定自己的起點。失敗者看的是別人的終點，成功者看的是自己的進步。'
      ]},
      { type: 'highlight', title: '教練的最後鼓勵', text: '健身最難的一天，永遠是「今天」。你會經歷肌肉痠痛到想哭的時候，會經歷體重卡住不動的停滯期，甚至會經歷生活忙碌到想放棄訓練的時刻。\n\n這都沒關係。\n\n如果你今天沒去練，明天再去就好；如果你這餐亂吃了，下一餐吃回來就好。健身房的大門永遠為你而開，肌肉永遠不會背叛你的努力。\n\n這份指南是你的武器，而你是自己的英雄。現在，放下手機，換上運動鞋，去創造那個讓你感到驕傲的自己吧！\n\n加油，我們健身房見！' }
    ]
  }
];

// --- Data: Glossary Items ---
const GLOSSARY_ITEMS = [
  // 1. 宏量營養素
  {
    term: '蛋白質', english: 'Protein', category: '宏量營養素',
    oneLine: '身體的磚塊，修補組織與長肌肉的主要材料。',
    whyItMatters: '吃不夠容易掉肌肉、免疫力變差、頭髮指甲脆弱；減脂期足夠蛋白質能維持代謝。',
    typicalSources: '雞胸肉、魚、雞蛋、豆腐、豆漿、優格、牛肉'
  },
  {
    term: '碳水化合物', english: 'Carbohydrate', category: '宏量營養素',
    oneLine: '身體的首選燃料，大腦和肌肉最愛用的能量。',
    whyItMatters: '完全不吃容易沒力氣、訓練表現差、情緒暴躁；但吃太多精緻碳水容易囤積脂肪。',
    typicalSources: '米飯、麵條、地瓜、馬鈴薯、水果、燕麥'
  },
  {
    term: '脂肪', english: 'Fat', category: '宏量營養素',
    oneLine: '高效率能量庫，也是製造荷爾蒙的原料。',
    whyItMatters: '不能完全不吃！過低脂肪會導致荷爾蒙失調（如停經）、皮膚乾燥、維生素吸收不良。',
    typicalSources: '酪梨、堅果、橄欖油、魚油、肥肉、蛋黃'
  },
  {
    term: '乳清蛋白', english: 'Whey Protein', category: '宏量營養素',
    oneLine: '從牛奶提煉，吸收速度超快的蛋白質補給。',
    whyItMatters: '運動後喝吸收最快，能迅速啟動肌肉修復；方便攜帶，是補充蛋白質的CP值之選。',
    typicalSources: '乳清蛋白粉（濃縮、分離、水解）'
  },
  {
    term: '酪蛋白', english: 'Casein', category: '宏量營養素',
    oneLine: '吸收緩慢的蛋白質，適合睡前喝。',
    whyItMatters: '能在睡眠期間持續緩慢釋放胺基酸，防止肌肉流失。',
    typicalSources: '牛奶、起司、酪蛋白粉'
  },
  {
    term: 'BCAA', english: 'Branched-Chain Amino Acids', category: '宏量營養素',
    oneLine: '支鏈胺基酸，肌肉最愛直接利用的三種胺基酸。',
    whyItMatters: '主要用於「防止肌肉流失」與「減緩運動疲勞」，對於長時間空腹訓練者較有幫助。',
    typicalSources: '雞肉、牛肉、乳清蛋白、BCAA補給品'
  },
  {
    term: '膳食纖維', english: 'Dietary Fiber', category: '宏量營養素',
    oneLine: '腸道的掃把，不會被吸收但對健康超重要。',
    whyItMatters: '增加飽足感、穩定血糖、幫助排便。吃夠纖維是減脂不挨餓的關鍵。',
    typicalSources: '蔬菜、水果、燕麥、糙米、奇亞籽'
  },
  {
    term: '反式脂肪', english: 'Trans Fat', category: '宏量營養素',
    oneLine: '人造壞油，對心血管危害最大的脂肪。',
    whyItMatters: '會增加壞膽固醇、塞血管，法規已嚴格限制，但仍需注意加工食品標示。',
    typicalSources: '部分氫化植物油、老式奶精、廉價糕點、炸物'
  },
  {
    term: 'Omega-3', english: 'Omega-3 Fatty Acids', category: '宏量營養素',
    oneLine: '能抗發炎的「好脂肪酸」。',
    whyItMatters: '現代人飲食容易發炎（Omega-6太多），Omega-3 能保護心血管、大腦與眼睛。',
    typicalSources: '鮭魚、鯖魚、亞麻仁油、核桃、魚油'
  },
  {
    term: 'MCT 油', english: 'Medium-Chain Triglyceride', category: '宏量營養素',
    oneLine: '中鏈脂肪酸，能快速轉換成能量的好油。',
    whyItMatters: '常被用於生酮飲食或防彈咖啡，因為它能快速產能且較不易囤積成體脂。',
    typicalSources: '椰子油、MCT油'
  },

  // 2. 維生素
  {
    term: '維生素 B群', english: 'Vitamin B Complex', category: '維生素',
    oneLine: '能量代謝的輔助大隊，幫你把食物轉成能量。',
    whyItMatters: '覺得累、代謝差、常嘴破可能就是缺B群。運動量大的人消耗快，更需補充。',
    typicalSources: '全穀類、瘦肉、深綠色蔬菜、酵母'
  },
  {
    term: '維生素 C', english: 'Vitamin C', category: '維生素',
    oneLine: '抗氧化小尖兵，還能幫助膠原蛋白合成。',
    whyItMatters: '壓力大或高強度運動會消耗大量 Vit C，補充足夠能降低感冒風險。',
    typicalSources: '芭樂、奇異果、柑橘類、甜椒'
  },
  {
    term: '維生素 D', english: 'Vitamin D', category: '維生素',
    oneLine: '其實是種類荷爾蒙，管骨頭也管免疫力。',
    whyItMatters: '現代人少曬太陽普遍缺乏。缺D會影響鈣吸收、骨質疏鬆、甚至影響心情與睪固酮。',
    typicalSources: '曬太陽、鮭魚、蛋黃、強化牛奶、補給品'
  },

  // 3. 礦物質
  {
    term: '鈣', english: 'Calcium', category: '礦物質',
    oneLine: '不只補骨頭，肌肉收縮和神經傳導也靠它。',
    whyItMatters: '長期缺鈣會骨質疏鬆，且容易抽筋、情緒焦慮。',
    typicalSources: '牛奶、優格、板豆腐、小魚乾、黑芝麻'
  },
  {
    term: '鐵', english: 'Iron', category: '礦物質',
    oneLine: '造血關鍵，幫你把氧氣送到全身。',
    whyItMatters: '缺鐵會容易累、頭暈、臉色蒼白、運動喘不過氣。女生因生理期更需注意。',
    typicalSources: '紅肉、豬血、蛤蜊、深綠色蔬菜（吸收率較差）'
  },
  {
    term: '鎂', english: 'Magnesium', category: '礦物質',
    oneLine: '放鬆礦物質，助眠又防抽筋。',
    whyItMatters: '壓力大會流失鎂。補鎂能幫助肌肉放鬆、改善睡眠品質、穩定神經。',
    typicalSources: '深綠色蔬菜、堅果、香蕉、黑巧克力'
  },
  {
    term: '鈉', english: 'Sodium', category: '礦物質',
    oneLine: '水分平衡的關鍵，吃太鹹會水腫。',
    whyItMatters: '運動流汗需要補鈉防抽筋，但平時外食族容易攝取過量導致高血壓與水腫。',
    typicalSources: '鹽、醬油、加工食品、運動飲料'
  },
  {
    term: '鉀', english: 'Potassium', category: '礦物質',
    oneLine: '鈉的死對頭，幫你排鈉消水腫。',
    whyItMatters: '多吃高鉀食物可以平衡鹽分攝取，預防高血壓與水腫。',
    typicalSources: '香蕉、馬鈴薯、奇異果、深色蔬菜'
  },
  {
    term: '鋅', english: 'Zinc', category: '礦物質',
    oneLine: '傷口癒合與男性荷爾蒙的守護者。',
    whyItMatters: '對免疫系統、皮膚修復、睪固酮合成非常重要。',
    typicalSources: '牡蠣、海鮮、牛肉、南瓜籽'
  },
  {
    term: '電解質', english: 'Electrolytes', category: '礦物質',
    oneLine: '帶電的礦物質戰隊（鈉、鉀、鈣、鎂）。',
    whyItMatters: '負責神經傳導與肌肉收縮。大量流汗後只喝水不補電解質，容易導致抽筋或水中毒。',
    typicalSources: '運動飲料、椰子水、鹽巴'
  },

  // 4. 運動補給
  {
    term: '肌酸', english: 'Creatine', category: '運動補給',
    oneLine: '肌肉的備用電池，提升爆發力與力量。',
    whyItMatters: '目前研究最透徹、最安全的補給品之一。能增加肌肉含水量與力量表現。',
    typicalSources: '紅肉（量少）、肌酸粉'
  },
  {
    term: 'Beta-丙氨酸', english: 'Beta-Alanine', category: '運動補給',
    oneLine: '抗酸劑，幫你多做幾下的一種胺基酸。',
    whyItMatters: '能中和肌肉酸性，延緩疲勞。副作用是皮膚會有刺刺癢癢的感覺（無害）。',
    typicalSources: '紅肉、補給品'
  },
  {
    term: '預鍛鍊飲品', english: 'Pre-workout', category: '運動補給',
    oneLine: '喝了會High的綜合提神粉。',
    whyItMatters: '通常含大量咖啡因、B群、丙氨酸等，用來提升訓練專注度與興奮感。',
    typicalSources: '市售 Pre-workout 產品'
  },
  {
    term: '咖啡因', english: 'Caffeine', category: '運動補給',
    oneLine: '天然且有效的興奮劑，提升專注與代謝。',
    whyItMatters: '運動前攝取能降低疲勞感、提升燃脂效率。但太晚喝會影響睡眠。',
    typicalSources: '咖啡、茶、能量飲'
  },

  // 5. 食品標示
  {
    term: '熱量 / 大卡', english: 'Calories / kcal', category: '常見標示',
    oneLine: '能量單位，體重增減的基礎算術。',
    whyItMatters: '吃進去 > 消耗掉 = 變胖。不管食物多健康，熱量超標一樣會胖。',
    onLabel: '大卡、Kcal'
  },
  {
    term: '份量', english: 'Serving Size', category: '常見標示',
    oneLine: '包裝上「一份」是多少，陷阱都在這。',
    whyItMatters: '一包餅乾可能含「5份」，只看「每份熱量」會低估攝取量，要乘上份數才是總熱量。',
    onLabel: '本包裝含 X 份'
  },
  {
    term: '每日參考值百分比', english: '%DV', category: '常見標示',
    oneLine: '這份食物佔了你一天所需的百分之幾。',
    whyItMatters: '快速判斷營養素高低的指標。例如鈉含量 %DV 超過 20% 通常算高鈉食物。',
    onLabel: '每日參考值百分比'
  },
  {
    term: '升糖指數', english: 'GI (Glycemic Index)', category: '常見標示',
    oneLine: '食物讓血糖上升速度的指標。',
    whyItMatters: '低 GI (糙米) 血糖穩、耐餓；高 GI (糖果) 血糖衝高、易囤脂且餓得快。',
    onLabel: '低GI'
  },
  {
    term: '代糖 / 甜味劑', english: 'Sweeteners', category: '常見標示',
    oneLine: '有甜味但沒熱量（或極低）的魔法粉。',
    whyItMatters: '如赤藻糖醇、阿斯巴甜。減脂期解饞好幫手，但部分人吃多會脹氣或腹瀉。',
    onLabel: '赤藻糖醇、阿斯巴甜、蔗糖素'
  },

  // 6. 保健與其他
  {
    term: '益生菌', english: 'Probiotic', category: '保健機能',
    oneLine: '腸道的好朋友軍團。',
    whyItMatters: '維持腸道菌相平衡，改善便秘、腹瀉與免疫調節。',
    typicalSources: '優格、泡菜、益生菌粉'
  },
  {
    term: '益生元', english: 'Prebiotic', category: '保健機能',
    oneLine: '益生菌的食物，幫好菌長大的肥料。',
    whyItMatters: '光吃菌不給食物沒用。多吃膳食纖維就是最好的益生元。',
    typicalSources: '膳食纖維、果寡糖'
  },
  {
    term: '膠原蛋白', english: 'Collagen', category: '保健機能',
    oneLine: '皮膚與關節的鋼筋支架。',
    whyItMatters: '雖然吃進去會被分解成胺基酸，但補充特定胜肽可能有助皮膚彈性與關節潤滑。需搭配維生素C。',
    typicalSources: '豬腳（脂肪高）、膠原蛋白粉'
  },
  {
    term: '輔酶 Q10', english: 'CoQ10', category: '保健機能',
    oneLine: '細胞發電廠的火星塞。',
    whyItMatters: '隨著年紀減少，補充有助心臟無力改善與抗氧化。',
    typicalSources: '心臟、牛肉、沙丁魚'
  },
  {
    term: '葉黃素', english: 'Lutein', category: '保健機能',
    oneLine: '眼睛的太陽眼鏡，過濾藍光。',
    whyItMatters: '人體無法自行合成，現代人3C用眼過度必備。它是脂溶性，要飯後吃才好吸收。',
    typicalSources: '菠菜、羽衣甘藍、蛋黃'
  }
];

// --- Data: Knowledge Library (Updated with LV3) ---
const KNOWLEDGE_LIBRARY = [
  // ... LV1 existing chapters ...
  {
    id: 'lv1-starch-basics',
    level: 1,
    categoryKey: 'Awareness',
    title: '澱粉與主食：假蔬菜真澱粉',
    subtitle: '看起來很清爽，其實是澱粉炸彈',
    summary: '許多人以為只有米飯麵條是澱粉，其實很多「根莖類」植物在營養學上都是主食。如果把這類食材當成蔬菜吃到飽，熱量很容易爆表。',
    keyPoints: [
      '分辨原則：吃起來粉粉的、有飽足感的植物根莖，通常是澱粉。',
      '常見偽裝：玉米、南瓜、地瓜、芋頭、山藥、蓮藕、菱角、紅豆綠豆。',
      '加工陷阱：冬粉、米粉、蘿蔔糕、湯圓、豬血糕，這些都是高密度澱粉。',
      '交換法則：如果有吃上述食材，當餐的「白飯」就要減少或不吃。'
    ],
    examples: [
      '自助餐夾了「三色豆」當配菜？那其實是兩份澱粉（玉米+豌豆）配一點點蔬菜（紅蘿蔔）。',
      '火鍋裡的「冬粉」吸滿湯汁後，熱量比一碗飯還高，絕對不是清爽的蔬菜替代品。'
    ],
    commonMistakes: [
      '以為南瓜湯很健康可以一直喝，結果攝取過多醣類。',
      '以為綠豆湯是「喝湯」，其實是在「喝飯」。'
    ],
    tinyActions: [
      '下次吃自助餐時，先掃描一輪菜色，指出哪幾道其實是「隱藏版澱粉」。',
      '點火鍋時，副餐選了冬粉，記得當天晚餐的飯量減半。'
    ],
    estimatedReadingMinutes: 2
  },
  {
    id: 'lv1-protein-traps',
    level: 1,
    categoryKey: 'Awareness',
    title: '蛋白質與加工品：隱形熱量地雷',
    subtitle: '不是所有豆製品和肉類都是好隊友',
    summary: '蛋白質是增肌減脂的關鍵，但「加工過程」往往會加入大量油脂與澱粉，讓你以為在補蛋白，其實在喝油。',
    keyPoints: [
      '優質蛋白原則：優先選擇「原型食物」，如雞蛋、雞胸、鮮魚、毛豆、嫩豆腐。',
      '高脂加工肉：香腸、熱狗、培根、貢丸，這些通常脂肪含量高於蛋白質。',
      '豆類陷阱：百頁豆腐（油豆腐）、炸豆皮、花干，這些都是「吸油海綿」。',
      '假肉真澱粉：蟹肉棒、魚板、黑輪，主要成分其實是魚漿加大量澱粉。'
    ],
    examples: [
      '滷味攤的「百頁豆腐」一條熱量可能超過 500 卡，比一碗飯還高。',
      '早餐店的「培根蛋餅」，培根其實算油脂類，不是優質肉類。'
    ],
    commonMistakes: [
      '吃火鍋為了健康點了很多「蟹肉棒」，結果吃進一堆澱粉。',
      '素食者常吃「素肉、麵筋、烤麩」，這些通常都是高油高鈉加工品。'
    ],
    tinyActions: [
      '去便利商店看營養標示，比較一下「熱狗」與「雞胸肉」的脂肪含量差異。',
      '下次吃火鍋，把所有的加工火鍋料換成嫩豆腐或鮮魚片。'
    ],
    estimatedReadingMinutes: 3
  },
  {
    id: 'lv1-fats-nuts',
    level: 1,
    categoryKey: 'Awareness',
    title: '油脂與堅果種子：好油壞油分清楚',
    subtitle: '酪梨不是水果，它是油！',
    summary: '油脂是人體必需營養素，但熱量密度最高（1g = 9kcal）。重點在於辨識「好油」並控制份量，而不是完全不吃。',
    keyPoints: [
      '分類誤區：酪梨、芝麻、花生、椰奶、鮮奶油，這些全是「油脂類」。',
      '堅果適量：堅果雖好，但熱量極高，一天建議量約「大拇指第一指節」大小。',
      '隱形油脂：沙拉醬（凱薩醬、千島醬）、麵包抹醬、酥皮濃湯。',
      '好油來源：橄欖油、酪梨、魚油、無調味堅果。'
    ],
    examples: [
      '喝泰式酸辣湯裡的「椰奶」，其實等於在喝油。',
      '以為吃生菜沙拉很健康，結果淋了兩大匙凱薩醬，熱量直接爆表。'
    ],
    commonMistakes: [
      '把酪梨當成飯後水果吃，結果整天油脂攝取超標。',
      '以為堅果很健康就抱著桶子一直吃。'
    ],
    tinyActions: [
      '吃沙拉時，試著把醬料改為「和風醬」或「油醋醬」，並且沾著吃而非淋上去。',
      '檢查一下今天的早餐，是不是吃下了過多的抹醬或鮮奶油？'
    ],
    estimatedReadingMinutes: 2
  },
  {
    id: 'lv1-veg-fruit',
    level: 1,
    categoryKey: 'Awareness',
    title: '蔬菜與水果：不要傻傻分不清楚',
    subtitle: '水果不能取代蔬菜，玉米筍是蔬菜',
    summary: '蔬菜和水果雖然都富含纖維，但水果含有較高的果糖，不能因為懶得煮菜就只吃水果。',
    keyPoints: [
      '大小番茄大不同：大番茄是「蔬菜」（低糖），小番茄是「水果」（高糖）。',
      '蔬菜定義：熱量低、纖維高，如葉菜類、玉米筍、大番茄、小黃瓜、海帶、木耳。',
      '水果限制：台灣水果通常很甜，減脂期建議一天 2 份（約 2 個拳頭大）。',
      '低 GI 水果推薦：芭樂、奇異果、蘋果（帶皮）、莓果類。'
    ],
    examples: [
      '木耳飲如果微糖，可以當作補充膳食纖維的好來源（木耳是蔬菜）。',
      '玉米筍看起來像澱粉，其實它是未成熟的玉米，屬於蔬菜類，可以多吃！'
    ],
    commonMistakes: [
      '覺得今天沒吃菜，晚上怒吃兩顆大芒果補償（糖分爆炸）。',
      '把酸菜、醬瓜當成蔬菜來源（鈉含量過高，營養流失）。'
    ],
    tinyActions: [
      '下一餐試著把水果量控制在一個拳頭大小。',
      '去超市找找看「玉米筍」和「大番茄」，把它們加入你的購物籃。'
    ],
    estimatedReadingMinutes: 2
  },
  {
    id: 'lv1-dairy-alternatives',
    level: 1,
    categoryKey: 'Awareness',
    title: '乳品與替代品：喝錯補不到鈣',
    subtitle: '燕麥奶不是奶，是澱粉水',
    summary: '植物奶很流行，但它們的營養價值跟牛奶完全不同。選擇飲品時，要清楚自己是想補鈣、補蛋白，還是單純好喝。',
    keyPoints: [
      '鮮奶/奶粉：主要提供鈣質與蛋白質，屬於乳品類。',
      '豆漿：提供蛋白質，但鈣質極低（除非喝高鈣豆漿），屬於豆魚蛋肉類。',
      '燕麥奶/米漿：主要成分是碳水化合物，屬於全穀雜糧類（澱粉），蛋白質與鈣都很低。',
      '杏仁奶：市售多為水+杏仁油+糖，熱量低但營養密度也低。'
    ],
    examples: [
      '拿鐵（牛奶）換成燕麥奶，其實是把蛋白質換成了澱粉，熱量可能更高。',
      '早餐喝米漿配飯糰，等於是「澱粉配澱粉」，升糖指數爆表。'
    ],
    commonMistakes: [
      '以為喝燕麥奶可以補鈣長高。',
      '以為乳酸飲料（如養樂多）等於喝牛奶，其實那是糖水。'
    ],
    tinyActions: [
      '如果你有乳糖不耐症，改喝「無糖豆漿」補蛋白，並透過深綠色蔬菜或黑芝麻補鈣。',
      '買咖啡時，意識到「換燕麥奶」等於增加碳水攝取。'
    ],
    estimatedReadingMinutes: 3
  },
  {
    id: 'lv1-beverage-snacks',
    level: 1,
    categoryKey: 'Awareness',
    title: '飲料與零食陷阱：甜蜜的陷阱',
    subtitle: '果汁其實是含糖飲料',
    summary: '除了正餐，我們攝取的「流質熱量」與「無意識零食」往往是發胖主因。許多聽起來健康的食物，其實加工後營養全失。',
    keyPoints: [
      '果汁 vs 水果：果汁濾掉纖維，血糖上升速度快，且容易喝過量（一杯柳橙汁=5顆柳橙的糖）。',
      '蔬果乾陷阱：經過脫水與油炸，體積縮小但熱量濃縮，且常添加糖鹽。',
      '勾芡湯品：酸辣湯、玉米濃湯、麵線糊，這些湯底都是澱粉勾芡，熱量高且易囤積。',
      '手搖飲配料：珍珠、芋圓、粉條全部都是澱粉，一杯全糖珍奶熱量直逼便當。'
    ],
    examples: [
      '覺得吃水果麻煩所以喝「每日C」，其實喝進了大量游離糖。',
      '下午茶吃「乾燥蔬菜脆片」，以為很健康，其實吃進大量油脂。'
    ],
    commonMistakes: [
      '以為「微糖」飲料熱量很低，其實含糖量依然驚人。',
      '吃飯習慣配一碗勾芡的羹湯，讓整餐GI值飆高。'
    ],
    tinyActions: [
      '下次想喝果汁時，直接去買一顆水果來咬。',
      '點手搖飲時，嘗試「無糖」或「一分糖」，並拒絕加料。'
    ],
    estimatedReadingMinutes: 3
  },
  // ... LV2 chapters ...
  {
    id: 'lv2-hand-method',
    level: 2,
    categoryKey: 'Quantification',
    title: '手掌法則：隨身攜帶的測量神器',
    subtitle: '不用秤也能算熱量？你的手就是最佳工具',
    summary: '在外吃飯不可能隨身帶電子秤，學會用「手掌」來估算份量，是你控制飲食最實用的技能。這套方法能讓你一眼看出這餐有沒有超標。',
    keyPoints: [
      '蛋白質（豆魚蛋肉）：看「手掌心」大小與厚度，女生一餐一份，男生一餐兩份。',
      '蔬菜（纖維）：看「拳頭」大小，每餐至少要大於一個拳頭。',
      '碳水化合物（澱粉）：看「拳頭」或「碗」，減脂期建議每餐控制在一個拳頭內。',
      '油脂與堅果：看「大拇指」，一節大拇指約為一茶匙的油。'
    ],
    examples: [
      '自助餐夾肉時，那塊排骨如果比你的手掌大很多，那可能就是 2 份蛋白質（與油脂）。',
      '便利商店的御飯糰，大約就是一個女生拳頭大的澱粉量。'
    ],
    commonMistakes: [
      '只看面積不看厚度：一片薄薄的肉片跟厚切牛排，蛋白質含量差很多。',
      '忽略烹調用油：雖然只吃了一掌心的肉，但如果是炸的，熱量要加倍算。'
    ],
    tinyActions: [
      '現在伸出你的手，看看你的「掌心」有多大，這就是你下一餐肉類的建議份量。',
      '下一餐吃飯時，試著用拳頭比對一下碗裡的飯，是多於一個拳頭還是少於？'
    ],
    estimatedReadingMinutes: 3
  },
  {
    id: 'lv2-calorie-density',
    level: 2,
    categoryKey: 'Quantification',
    title: '熱量密度：為什麼吃得少卻變胖？',
    subtitle: '體積大不代表熱量高，吃對食物能越吃越瘦',
    summary: '「熱量密度」是指每公克食物含有的熱量。掌握這個概念，你就能在減脂期吃得飽又不爆卡。重點是選擇「低密度、高體積」的食物。',
    keyPoints: [
      '高密度地雷（紅燈）：油脂、堅果、餅乾、蛋糕、炸物。一小口就破百卡。',
      '中密度（黃燈）：米飯、麵條、肉類、麵包。適量食用。',
      '低密度救星（綠燈）：蔬菜、水果、湯（清湯）、豆腐、蒟蒻。吃一大盆熱量都很低。',
      '飽足感關鍵：胃的飽脹感主要來自「體積」而非熱量。多吃綠燈食物能撐大胃壁產生飽足感。'
    ],
    examples: [
      '100g 的花椰菜只有 25 大卡，但 100g 的洋芋片有 540 大卡，熱量差了 20 倍！',
      '喝一杯珍奶的熱量（700卡），相當於吃 3 碗白飯，但飽足感卻差很多。'
    ],
    commonMistakes: [
      '以為堅果很健康就一直吃，殊不知它是超高熱量密度食物。',
      '為了減肥吃得很少（體積小），結果選的都是高密度食物（如一小塊蛋糕），反而更餓。'
    ],
    tinyActions: [
      '比較一下便利商店裡「一包堅果」和「一盒生菜沙拉」的熱量與體積。',
      '試著在正餐前先喝一大杯水或吃一碗燙青菜，感受一下飽足感的變化。'
    ],
    estimatedReadingMinutes: 3
  },
  {
    id: 'lv2-serving-concept',
    level: 2,
    categoryKey: 'Quantification',
    title: '「一份」是多少？建立份量絕對音感',
    subtitle: '1份醣 = 1/4碗飯，1份肉 = 1顆蛋',
    summary: '營養師常說的「一份」到底是多少？建立這個概念後，你就能快速換算不同食物。例如吃了半碗飯，就知道攝取了2份主食。',
    keyPoints: [
      '一份全穀雜糧（澱粉）：約 15g 碳水 = 1/4 碗飯 = 1/2 碗稀飯 = 1/2 片吐司 = 1/2 顆中型地瓜。',
      '一份豆魚蛋肉（蛋白質）：約 7g 蛋白質 = 1 顆蛋 = 1 杯無糖豆漿(190ml) = 3 指寬的肉。',
      '一份油脂：約 5g 油 = 1 茶匙油 = 2 粒核桃。',
      '一份水果：約 拳頭大 = 切塊後約 8 分滿碗。'
    ],
    examples: [
      '早餐吃了一個蛋餅（相當於半碗飯澱粉+1份油）加一顆蛋（1份蛋白），這樣你就知道這餐吃了什麼。',
      '喝了一瓶 400ml 的含糖飲料（含40g糖），大約等於吃了快 3 份主食（接近3/4碗飯）的熱量。'
    ],
    commonMistakes: [
      '以為水餃皮很薄不算澱粉，其實 3-4 顆水餃皮就等於 1/4 碗飯。',
      '以為香蕉一根就是一份，其實大根香蕉可能高達 2 份水果。'
    ],
    tinyActions: [
      '下次吃吐司時，記得一片就是「2份」主食（約半碗飯熱量）。',
      '去超商買豆漿，看背後的蛋白質含量，換算一下這瓶等於幾顆蛋。'
    ],
    estimatedReadingMinutes: 4
  },
  {
    id: 'lv2-eating-out',
    level: 2,
    categoryKey: 'Quantification',
    title: '外食份量直覺：便當與火鍋的真相',
    subtitle: '便當飯量通常超標，火鍋湯底是陷阱',
    summary: '台灣外食方便，但也充滿份量陷阱。便當店的飯量通常是建議量的 1.5 倍，火鍋的湯與醬料更是熱量黑洞。',
    keyPoints: [
      '便當法則：市售便當飯量約 1.5~2 碗，建議「飯吃一半」。主菜盡量選滷雞腿、蒸魚，避開炸排骨（吸油多）。',
      '火鍋攻略：湯底選昆布/蔬菜（清湯），避開麻辣/牛奶/沙茶（高油）。火鍋料全換蔬菜或嫩豆腐。',
      '便利商店：是練習看標示的最好地方。選擇「圓形食物」（地瓜、茶葉蛋、雞胸肉）最安全。',
      '自助餐：順序很重要，先夾滿半盤蔬菜，再夾掌心大蛋白質，最後補一點飯。'
    ],
    examples: [
      '一個炸雞腿便當熱量常突破 900 大卡，主要來自炸皮的油與過量的飯。',
      '吃火鍋沾沙茶醬，一碟熱量就超過 200 卡（等於一碗飯），改用醬油+蔥蒜辣椒最穩。'
    ],
    commonMistakes: [
      '覺得便當太油所以把菜過水，結果把飯全部吃光（澱粉過量）。',
      '吃火鍋時狂喝湯，結果鈉含量爆表導致隔天大水腫。'
    ],
    tinyActions: [
      '下次買便當，直接跟老闆說「飯一半」。',
      '去吃火鍋時，忍住不喝湯，並且醬料區只拿蔥、蒜、辣椒、醬油、醋。'
    ],
    estimatedReadingMinutes: 3
  },
  {
    id: 'lv2-portion-illusions',
    level: 2,
    categoryKey: 'Quantification',
    title: '常見份量錯覺：堅果與飲料的陷阱',
    subtitle: '拿鐵也是液體麵包，義大利麵是吸油怪',
    summary: '有些食物看起來無害，或者份量看起來不多，但熱量卻驚人。這些「視覺詐欺」是減重失敗的主因。',
    keyPoints: [
      '拿鐵效應：牛奶是液體熱量，一杯大杯拿鐵的牛奶熱量可能接近 200 卡。',
      '義大利麵：尤其是青醬和白醬，製作過程加入大量奶油與油，麵體又吸附醬汁，熱量遠高於同份量的湯麵。',
      '健康堅果：堅果很健康但熱量極高，一把抓下去可能就吃進半個便當的熱量。',
      '酒精陷阱：酒精 1g = 7kcal，且身體會優先代謝酒精而囤積脂肪，喝酒等於喝油。'
    ],
    examples: [
      '以為吃義大利麵比吃便當優雅輕盈，結果一盤白醬培根麵熱量破千。',
      '週末晚上喝了兩罐啤酒配一點堅果，熱量直接超過一頓晚餐。'
    ],
    commonMistakes: [
      '把拿鐵當水喝，忽略了裡面牛奶的熱量。',
      '以為青醬是蔬菜做的很健康，其實它是油+羅勒打出來的。'
    ],
    tinyActions: [
      '想喝咖啡時，試著改喝美式，或者把拿鐵換成「小杯」。',
      '吃義大利麵時，優先選擇清炒（蒜香）或紅醬，避開白醬與青醬。'
    ],
    estimatedReadingMinutes: 3
  },
  // --- LV3 New Chapters ---
  {
    id: 'lv3-cvs-survival',
    level: 3,
    categoryKey: 'Scenario',
    title: '便利商店生存指南',
    subtitle: '超商不是只有微波食品，是健人的軍火庫',
    summary: '便利商店是控制熱量最簡單的地方，因為所有營養標示都寫得清清楚楚。只要懂得組合，「澱粉+蛋白+纖維」的黃金公式隨手可得。',
    keyPoints: [
      '黃金組合公式：一份優質澱粉（地瓜/御飯糰） + 一份蛋白質（雞胸/茶葉蛋/豆漿） + 一份纖維（沙拉/水果）。',
      '地雷區：微波便當（鈉含量高、蔬菜少）、熱狗（高脂加工肉）、含糖優酪乳（糖分過高）。',
      '關東煮攻略：只夾原型食物（蘿蔔、香菇、蒟蒻、筊白筍），絕對不喝湯（鈉含量極高）。',
      '飲料選擇：無糖綠茶、黑咖啡、無糖豆漿是首選。燕麥飲通常有添加糖，需看標示。'
    ],
    examples: [
      '完美早餐：一顆茶葉蛋 + 無糖高纖豆漿 + 一根香蕉。',
      '高蛋白午餐：即食雞胸肉 +蕎麥涼麵（醬汁減半） + 溫泉蛋。'
    ],
    commonMistakes: [
      '覺得御飯糰很乾，所以配了一瓶含糖奶茶，結果糖分爆表。',
      '吃關東煮夾了貢丸、黑輪、豬血糕，以為是清淡的一餐，其實全是加工澱粉與油脂。'
    ],
    tinyActions: [
      '下次進超商，先走到「生鮮區」拿一盒沙拉或水果。',
      '練習翻到背面看「營養標示」，找出蛋白質超過 15g 的食品。'
    ],
    estimatedReadingMinutes: 3
  },
  {
    id: 'lv3-night-market',
    level: 3,
    categoryKey: 'Scenario',
    title: '夜市與小吃攤攻略',
    subtitle: '減脂也能逛夜市？選對食物就不怕胖',
    summary: '台灣夜市美食多半是「炸物」與「澱粉」的組合。要在這裡存活，關鍵在於「避開麵衣」與「減少醬料」。',
    keyPoints: [
      '鹽酥雞攻略：選雞肉/魷魚（去皮/不裹粉），搭配大量四季豆/青椒（不炸，請老闆燙或少油）。絕對不點：銀絲卷、百頁豆腐、炸湯圓。',
      '滷味攻略：是夜市最安全的選擇。大量夾青菜、海帶、豆干、豬腱肉。湯汁不要喝，酸菜少加。',
      '牛排攻略：點牛排/雞腿排（不加醬/醬另外放），麵換蛋（雙蛋），飲料改喝水。',
      '地雷小吃：蚵仔煎（太白粉勾芡+甜辣醬）、大腸包小腸（糯米+高脂肉+油）、地瓜球（純油炸澱粉）。'
    ],
    examples: [
      '滷味攤點了：大陸妹、金針菇、鳥蛋、腱子肉，請老闆只加蔥蒜醬油，不加香油辣油。',
      '口渴時買「愛玉檸檬（微糖）」或「無糖青草茶」，取代珍珠奶茶。'
    ],
    commonMistakes: [
      '以為章魚燒是海鮮，其實 90% 是麵糊與美乃滋。',
      '吃牛排把鐵板麵全部吃光，醬汁也拌進去，熱量直逼 1200 大卡。'
    ],
    tinyActions: [
      '吃夜市牛排時，嘗試跟老闆說「不要麵，換蛋」。',
      '買鹽酥雞時，堅持不加九層塔（超吸油），並用紙巾吸過再吃。'
    ],
    estimatedReadingMinutes: 4
  }
];

// --- Data: Central Question Bank (Updated with LV3) ---
const QUESTION_BANK = [
  // ... LV1 questions ...
  { id: 'l1-c1', level: 1, category: 'Awareness', type: 'choice', question: '下列哪一項食材在營養分類上屬於「全穀雜糧類」(澱粉)，而非蔬菜？', options: ['玉米筍', '玉米', '綠豆芽', '金針菇'], correct: 1, explanation: '玉米成熟後澱粉含量高，屬於全穀雜糧類；玉米筍則是蔬菜。' },
  { id: 'l1-c8', level: 1, category: 'Awareness', type: 'choice', question: '下列哪種「根莖類」食材其實是澱粉，熱量比一般蔬菜高出許多？', options: ['白蘿蔔', '紅蘿蔔', '牛蒡', '山藥'], correct: 3, explanation: '山藥、馬鈴薯、地瓜、芋頭都是澱粉來源。白蘿蔔與紅蘿蔔是蔬菜。' },
  { id: 'l1-c10', level: 1, category: 'Awareness', type: 'choice', question: '自助餐常見的「三色豆」，裡面的玉米和豌豆仁主要屬於什麼類別？', options: ['蔬菜類', '全穀雜糧類', '蛋白質類', '水果類'], correct: 1, explanation: '三色豆中有兩樣(玉米、豌豆仁)是澱粉，只有紅蘿蔔是蔬菜。' },
  { id: 'l1-c14', level: 1, category: 'Awareness', type: 'choice', question: '「蓮藕」在營養學分類上，主要屬於哪一類？', options: ['蔬菜類', '水果類', '全穀雜糧類', '蛋白質類'], correct: 2, explanation: '蓮藕富含澱粉，屬於全穀雜糧類，食用時需替代飯量。' },
  { id: 'l1-c15', level: 1, category: 'Awareness', type: 'choice', question: '口感清脆的「荸薺」常出現在肉丸中，它屬於哪一類？', options: ['蔬菜類', '全穀雜糧類', '水果類', '油脂類'], correct: 1, explanation: '荸薺雖然口感像蔬菜，但碳水化合物含量高，歸類為全穀雜糧類。' },
  { id: 'l1-c16', level: 1, category: 'Awareness', type: 'choice', question: '下列哪一種豆子，其實是「澱粉」而非蛋白質？', options: ['黃豆', '黑豆', '毛豆', '紅豆'], correct: 3, explanation: '紅豆、綠豆、花豆都是澱粉；「黃豆、黑豆、毛豆」才是豆類蛋白質三兄弟。' },
  { id: 'l1-c2', level: 1, category: 'Awareness', type: 'choice', question: '百頁豆腐的主要成分除了黃豆，還添加了大量的什麼？', options: ['水', '油脂', '纖維', '鈣質'], correct: 1, explanation: '百頁豆腐約有 50% 熱量來自油脂，屬於高脂加工食品。' },
  { id: 'l1-c7', level: 1, category: 'Awareness', type: 'choice', question: '火鍋料中的「蟹肉棒」主要成分是什麼？', options: ['螃蟹肉', '魚漿與澱粉', '雞肉', '豆腐'], correct: 1, explanation: '蟹肉棒是加工食品，主要成分是魚漿、澱粉、色素，碳水含量不低。' },
  { id: 'l1-c9', level: 1, category: 'Awareness', type: 'choice', question: '早餐店常見的「培根」屬於哪一類？', options: ['豆魚蛋肉類', '蔬菜類', '油脂類', '乳品類'], correct: 2, explanation: '培根脂肪比例極高，在營養分類上歸類為高脂肉類或油脂類，非優質蛋白。' },
  { id: 'l1-c12', level: 1, category: 'Awareness', type: 'choice', question: '壽司店的「豆皮壽司」，那片豆皮是怎麼處理的？', options: ['水煮', '油炸後糖漬', '烘烤', '發酵'], correct: 1, explanation: '豆皮本身是炸過的，再用糖水滷製，熱量與含糖量皆高。' },
  { id: 'l1-c17', level: 1, category: 'Awareness', type: 'choice', question: '下列哪種素食材料，其實是「蛋白質」來源？', options: ['麵筋', '冬粉', '蒟蒻', '寒天'], correct: 0, explanation: '麵筋是麵粉洗去澱粉後剩下的「小麥蛋白」，屬於蛋白質；冬粉是澱粉。' },
  { id: 'l1-c18', level: 1, category: 'Awareness', type: 'choice', question: '關於「毛豆」的分類，下列何者正確？', options: ['它是蔬菜', '它是澱粉', '它是優質蛋白質', '它是油脂'], correct: 2, explanation: '毛豆是未成熟的黃豆，屬於優質蛋白質來源。' },
  { id: 'l1-c3', level: 1, category: 'Awareness', type: 'choice', question: '酪梨(Avocado)在營養學分類中，主要屬於哪一類？', options: ['水果類', '蔬菜類', '油脂與堅果種子類', '蛋白質類'], correct: 2, explanation: '酪梨脂肪含量高，被歸類為油脂類，不應當作一般水果大量食用。' },
  { id: 'l1-c6', level: 1, category: 'Awareness', type: 'choice', question: '下列哪一個選項其實是「油脂」而非堅果或豆類？', options: ['杏仁果', '腰果', '芝麻', '紅豆'], correct: 2, explanation: '芝麻、花生、瓜子都屬於「油脂與堅果種子類」。' },
  { id: 'l1-c19', level: 1, category: 'Awareness', type: 'choice', question: '泰式料理常見的「椰奶 (Coconut Milk)」，主要營養素是？', options: ['蛋白質', '碳水化合物', '油脂', '膳食纖維'], correct: 2, explanation: '椰奶是椰肉榨出的汁，飽和脂肪含量極高，屬於油脂類，非乳製品。' },
  { id: 'l1-c20', level: 1, category: 'Awareness', type: 'choice', question: '蛋糕上的「鮮奶油 (Cream)」是由牛奶提煉，但它屬於哪一類？', options: ['乳品類', '油脂類', '蛋白質類', '糖類'], correct: 1, explanation: '鮮奶油是從牛奶中提煉出的脂肪，熱量幾乎全來自油脂。' },
  { id: 'l1-c5', level: 1, category: 'Awareness', type: 'choice', question: '減脂期間想吃番茄，應該選哪一種熱量較低且屬於蔬菜類？', options: ['聖女小番茄', '大番茄', '番茄果乾', '梅漬番茄'], correct: 1, explanation: '大番茄是蔬菜，含糖低；小番茄是水果，含糖較高。' },
  { id: 'l1-c11', level: 1, category: 'Awareness', type: 'choice', question: '下列哪一種飲料其實屬於「乳製品」，可以補充鈣質？', options: ['燕麥奶', '豆漿', '鮮奶', '杏仁奶'], correct: 2, explanation: '鮮奶是乳品類。燕麥奶是澱粉水，豆漿是蛋白質，市售杏仁奶通常油脂為主。' },
  { id: 'l1-c13', level: 1, category: 'Awareness', type: 'choice', question: '「檸檬」雖然吃起來很酸，但在分類上屬於？', options: ['蔬菜類', '水果類', '調味料', '無熱量食材'], correct: 1, explanation: '檸檬屬於水果類，依然含有果糖，不能因為酸就誤以為沒有熱量。' },
  { id: 'l1-c21', level: 1, category: 'Awareness', type: 'choice', question: '「海帶」與「紫菜」在營養分類上屬於？', options: ['蔬菜類', '海鮮類', '澱粉類', '油脂類'], correct: 0, explanation: '藻類富含纖維與礦物質，歸類為蔬菜類。' },
  { id: 'l1-c22', level: 1, category: 'Awareness', type: 'choice', question: '下列哪種飲料通常含糖量極高，且乳含量低，不建議當作補充奶類？', options: ['全脂鮮奶', '無糖優酪乳', '乳酸飲料(如養樂多)', '保久乳'], correct: 2, explanation: '乳酸飲料通常添加大量糖分來平衡酸味，且蛋白質與鈣質含量遠低於鮮奶。' },
  { id: 'l1-b1', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 「冬粉」看起來透明清爽，所以熱量很低，可以當作蔬菜吃到飽？', options: ['正確', '錯誤'], correct: 1, explanation: '錯誤。冬粉是綠豆澱粉做的，吸水率高，本質是主食（澱粉），且極易吸附湯汁油脂。' },
  { id: 'l1-b2', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 菱角、栗子吃起來粉粉的，因為它們是「全穀雜糧類」(澱粉)？', options: ['正確', '錯誤'], correct: 0, explanation: '正確。菱角、栗子都是澱粉來源，吃多需要減少米飯攝取。' },
  { id: 'l1-b3', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 南瓜、山藥、地瓜都是蔬菜，減肥時可以多吃來取代正餐？', options: ['正確', '錯誤'], correct: 1, explanation: '錯誤。它們是澱粉，雖然比白飯營養，但仍需控制份量，不能當作「蔬菜」吃到飽。' },
  { id: 'l1-b4', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 鴨血和豬血糕看起來很像，所以它們都是蛋白質來源？', options: ['正確', '錯誤'], correct: 1, explanation: '錯誤。鴨血是純蛋白質；豬血糕混入了大量糯米，屬於「澱粉類」。' },
  { id: 'l1-b5', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 香腸、熱狗雖然是肉做的，但屬於「高脂肉類」，不建議常吃？', options: ['正確', '錯誤'], correct: 0, explanation: '正確。加工肉品通常脂肪含量高，且含有亞硝酸鹽等添加物。' },
  { id: 'l1-b6', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 希臘優格(Greek Yogurt)屬於乳製品，且蛋白質含量通常比一般優格高？', options: ['正確', '錯誤'], correct: 0, explanation: '正確。希臘優格過濾了乳清，質地濃稠，蛋白質含量是普通優格的 2 倍以上。' },
  { id: 'l1-b7', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 豆輪、烤麩這些素料，經過油炸處理，熱量通常比一般豆腐高很多？', options: ['正確', '錯誤'], correct: 0, explanation: '正確。這些加工豆製品吸油量極高，是素食者的熱量陷阱。' },
  { id: 'l1-b8', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 橄欖油因為很健康，所以多吃不會變胖，可以盡量喝？', options: ['正確', '錯誤'], correct: 1, explanation: '錯誤。橄欖油雖然是好油，但它依然是脂肪，1公克9大卡，過量一樣會囤積脂肪。' },
  { id: 'l1-b9', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 花生醬是植物性的，所以屬於健康的蛋白質來源？', options: ['正確', '錯誤'], correct: 1, explanation: '錯誤。花生屬於油脂類，花生醬雖含部分蛋白，但絕大多數熱量來自脂肪與添加糖。' },
  { id: 'l1-b10', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 「奶油 (Butter)」是牛奶做的，所以算是乳製品，可以補鈣？', options: ['正確', '錯誤'], correct: 1, explanation: '錯誤。奶油是從牛奶提煉出的脂肪，屬於「油脂類」，鈣質含量極低。' },
  { id: 'l1-b11', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 為了方便，我可以喝「100% 果汁」來完全取代吃水果？', options: ['正確', '錯誤'], correct: 1, explanation: '錯誤。果汁濾掉了最重要的膳食纖維，且容易攝取過量糖分，血糖波動大。' },
  { id: 'l1-b12', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 蔬果乾(如乾燥秋葵、香蕉片)是健康的零食，熱量很低？', options: ['正確', '錯誤'], correct: 1, explanation: '錯誤。蔬果乾經過脫水體積變小，容易吃過量，且市售品常經油炸或加糖，熱量驚人。' },
  { id: 'l1-b13', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 木耳(黑木耳/白木耳)富含膠質，在分類上屬於蔬菜類？', options: ['正確', '錯誤'], correct: 0, explanation: '正確。木耳屬於菇類（蔬菜），富含水溶性膳食纖維，熱量低。' },
  { id: 'l1-b14', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 酸辣湯、玉米濃湯因為有勾芡，所以熱量會比清湯高很多？', options: ['正確', '錯誤'], correct: 0, explanation: '正確。勾芡使用的是太白粉（澱粉），會大幅增加湯品的熱量與GI值。' },
  { id: 'l1-b15', level: 1, category: 'Awareness', type: 'boolean', question: 'Q. (是非題) 奇異果、芭樂雖然甜，但屬於低 GI 水果，適合減脂期食用？', options: ['正確', '錯誤'], correct: 0, explanation: '正確。它們富含纖維與維生素C，對血糖影響相對較小，但仍需控制份量。' },

  // ==========================================
  // Level 2: Choice (選擇題 - 份量估算)
  // ==========================================

  {
    id: 'l2-c01', level: 2, category: 'Quantification', type: 'choice',
    question: '一個市售常見的炸排骨便當，總熱量大約落在哪個區間？',
    options: ['400-500卡', '500-600卡', '800-900卡', '1200卡以上'],
    correct: 2, explanation: '飯量約 1.5 碗(420卡) + 炸排骨(300卡) + 配菜(油炒)，輕易突破 800 卡。'
  },
  {
    id: 'l2-c02', level: 2, category: 'Quantification', type: 'choice',
    question: '根據「手掌法則」，一般女性一餐建議攝取多少份量的豆魚蛋肉類？',
    options: ['一個指節', '一個掌心(不含手指)', '一個拳頭', '兩隻手掌'],
    correct: 1, explanation: '女性一餐建議約一掌心大小與厚度的蛋白質，男性則建議一掌心至一整手掌。'
  },
  {
    id: 'l2-c03', level: 2, category: 'Quantification', type: 'choice',
    question: '一碗尖尖的白飯(約200g)，熱量大約是多少？',
    options: ['140卡 (半碗)', '280卡 (一碗)', '420卡 (一碗半)', '560卡 (兩碗)'],
    correct: 1, explanation: '標準一碗飯 (160g) 約 280 大卡，尖尖的飯可能會超過，但最接近 280 卡。'
  },
  {
    id: 'l2-c04', level: 2, category: 'Quantification', type: 'choice',
    question: '1公克的脂肪可以產生約多少大卡的熱量？',
    options: ['4大卡', '7大卡', '9大卡', '12大卡'],
    correct: 2, explanation: '脂肪是熱量密度最高的營養素，1g 提供 9kcal；碳水與蛋白質則為 4kcal。'
  },
  {
    id: 'l2-c05', level: 2, category: 'Quantification', type: 'choice',
    question: '一份水果（約60大卡）的份量大約是多少？',
    options: ['一顆大蘋果', '一個拳頭大', '兩根香蕉', '半顆小番茄'],
    correct: 1, explanation: '一份水果約為一個女生的拳頭大小，或切塊後裝在碗裡約 8 分滿。'
  },
  {
    id: 'l2-c06', level: 2, category: 'Quantification', type: 'choice',
    question: '下列哪種早餐組合的熱量密度最高（體積小但熱量高）？',
    options: ['地瓜 + 無糖豆漿', '生菜沙拉 + 茶葉蛋', '燒餅油條', '饅頭夾蛋'],
    correct: 2, explanation: '燒餅油條是「油包油」的組合，麵糰吸滿油脂，體積雖不大但熱量極高。'
  },
  {
    id: 'l2-c07', level: 2, category: 'Quantification', type: 'choice',
    question: '去便利商店買「雞胸肉」，一塊（約100g-110g）通常含有多少蛋白質？',
    options: ['10g', '20-24g', '40g', '5g'],
    correct: 1, explanation: '市售即食雞胸肉一份約含 20-24g 蛋白質，約等於 3 份豆魚蛋肉類。'
  },
  {
    id: 'l2-c08', level: 2, category: 'Quantification', type: 'choice',
    question: '堅果雖然健康，但熱量很高。每日建議攝取量約為多少？',
    options: ['一碗公', '一整包', '大拇指第一指節大小 (約1份油脂)', '隨意吃到飽'],
    correct: 2, explanation: '堅果屬於油脂類，每日建議一茶匙或大拇指指節大小（約 5 顆腰果）。'
  },
  {
    id: 'l2-c09', level: 2, category: 'Quantification', type: 'choice',
    question: '吃水餃時，一顆標準水餃的熱量大約落在哪裡？',
    options: ['10-20卡', '50-60卡', '100卡', '5卡'],
    correct: 1, explanation: '水餃皮是澱粉，內餡是絞肉（高脂），一顆約 50-60 卡，吃 10 顆就 500-600 卡。'
  },
  {
    id: 'l2-c10', level: 2, category: 'Quantification', type: 'choice',
    question: '大杯拿鐵（無糖，使用全脂奶）的熱量來源主要是什麼？',
    options: ['咖啡豆油脂', '牛奶', '水', '奶精'],
    correct: 1, explanation: '拿鐵中含有大量牛奶，一杯大杯拿鐵可能有 200-300ml 牛奶，熱量約 150-200 卡。'
  },
  {
    id: 'l2-c11', level: 2, category: 'Quantification', type: 'choice',
    question: '在火鍋店用餐，哪種主食的「吸油率」最高，熱量最容易爆表？',
    options: ['白飯', '烏龍麵', '冬粉', '雞蛋麵'],
    correct: 2, explanation: '冬粉極易吸附湯汁表面的浮油，煮在麻辣鍋或高湯中，熱量會翻倍。'
  },
  {
    id: 'l2-c12', level: 2, category: 'Quantification', type: 'choice',
    question: '一份「全穀雜糧類」（主食）含有 15g 碳水化合物，大約等於多少飯？',
    options: ['一碗飯', '半碗飯', '1/4 碗飯', '一口飯'],
    correct: 2, explanation: '1/4 碗飯（約40g熟飯）= 1 份主食 = 15g 碳水 = 70 大卡。'
  },
  {
    id: 'l2-c13', level: 2, category: 'Quantification', type: 'choice',
    question: '便利商店的「三角飯糰」，一個熱量大約是多少？',
    options: ['100卡', '200卡左右', '400卡', '600卡'],
    correct: 1, explanation: '一般三角飯糰熱量約在 180-220 卡之間，相當於 0.7 碗飯。'
  },
  {
    id: 'l2-c14', level: 2, category: 'Quantification', type: 'choice',
    question: '下列哪種醬料的「熱量密度」最高？',
    options: ['醬油', '烏醋', '沙茶醬', '番茄醬'],
    correct: 2, explanation: '沙茶醬主要成分是油、花生粉、魚乾，一湯匙熱量就破百卡，密度極高。'
  },
  {
    id: 'l2-c15', level: 2, category: 'Quantification', type: 'choice',
    question: '想減脂，在義大利麵餐廳點哪種口味通常熱量相對較低？',
    options: ['白醬培根', '青醬雞肉', '清炒蒜香蛤蜊', '肉醬焗烤'],
    correct: 2, explanation: '清炒用油量相對可控且無額外鮮奶油。白醬、青醬含大量油脂與奶油，焗烤更不用說。'
  },

  // ==========================================
  // Level 2: True/False (是非題 - 份量估算)
  // ==========================================

  {
    id: 'l2-b01', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 水果很健康，所以減肥期間可以無限量吃到飽，不用計算份量？',
    options: ['正確', '錯誤'], correct: 1, 
    explanation: '錯誤。水果含果糖，熱量不低。一般建議每餐一份（拳頭大），過量一樣會胖。'
  },
  {
    id: 'l2-b02', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 100g 的洋芋片和 100g 的花椰菜，熱量是一樣的？',
    options: ['正確', '錯誤'], correct: 1, 
    explanation: '錯誤。洋芋片是高熱量密度食物（約540卡），花椰菜是低密度（約25卡），差了20倍。'
  },
  {
    id: 'l2-b03', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 喝湯時，清湯通常比濃湯（勾芡、加奶油）熱量低很多？',
    options: ['正確', '錯誤'], correct: 0, 
    explanation: '正確。濃湯常加入澱粉勾芡或鮮奶油，熱量遠高於清湯。'
  },
  {
    id: 'l2-b04', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 一個拳頭大的饅頭，熱量跟一個拳頭大的地瓜差不多？',
    options: ['正確', '錯誤'], correct: 1, 
    explanation: '錯誤。饅頭紮實且精緻，熱量密度高（約280卡）；地瓜水分多纖維多（約140卡），饅頭熱量約是地瓜兩倍。'
  },
  {
    id: 'l2-b05', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 酒精的熱量很高，1g 酒精約有 7 大卡，接近脂肪的熱量？',
    options: ['正確', '錯誤'], correct: 0, 
    explanation: '正確。酒精熱量僅次於脂肪(9kcal)，且代謝時會優先堆積脂肪，是液體熱量炸彈。'
  },
  {
    id: 'l2-b06', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 為了精準控制飲食，每一餐都一定要用電子秤秤重才行？',
    options: ['正確', '錯誤'], correct: 1, 
    explanation: '錯誤。長期來說「手掌法則」更實用且容易執行，能幫助養成直覺，減少心理壓力。'
  },
  {
    id: 'l2-b07', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 蔬菜（如葉菜類）熱量極低，基本上可以視為「吃到飽」不限量？',
    options: ['正確', '錯誤'], correct: 0, 
    explanation: '正確。葉菜類體積大熱量低，多吃能增加飽足感，只要注意烹調不要加太多油即可。'
  },
  {
    id: 'l2-b08', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 兩顆核桃就大約等於一茶匙的油（一份油脂）？',
    options: ['正確', '錯誤'], correct: 0, 
    explanation: '正確。堅果種子類是油脂來源，份量稍微抓一點點就足夠了。'
  },
  {
    id: 'l2-b09', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 如果今天喝了一杯含糖飲料，它的熱量可能相當於多吃了一碗飯？',
    options: ['正確', '錯誤'], correct: 0, 
    explanation: '正確。一杯全糖珍奶熱量可達 700 卡，超過兩碗白飯的熱量。'
  },
  {
    id: 'l2-b10', level: 2, category: 'Quantification', type: 'boolean',
    question: 'Q. (是非題) 雞胸肉是低脂肉，所以不管用炸的還是煎的，熱量都一樣低？',
    options: ['正確', '錯誤'], correct: 1, 
    explanation: '錯誤。裹粉油炸會讓表皮吸附大量油脂，熱量可能比水煮高出一倍以上。'
  },

  // ==========================================
  // Level 3: Choice (選擇題 - 外食實戰)
  // ==========================================
  {
    id: 'l3-c01', level: 3, category: 'Scenario', type: 'choice',
    question: '在便利商店想組合成「減脂高蛋白餐」，下列哪個組合最好？',
    options: ['熱狗堡 + 含糖豆漿', '肉鬆飯糰 + 米漿', '即食雞胸肉 + 地瓜 + 無糖豆漿', '微波咖哩飯 + 奶茶'],
    correct: 2, explanation: '這是標準的「原型澱粉(地瓜) + 優質蛋白(雞胸/豆漿)」組合。其他選項多為加工品或高糖飲品。'
  },
  {
    id: 'l3-c02', level: 3, category: 'Scenario', type: 'choice',
    question: '逛夜市想吃「滷味」，下列哪種夾法最容易踩到「高油脂地雷」？',
    options: ['海帶 + 豆干', '豬腱肉 + 蘿蔔', '花干 + 炸豆皮 + 百頁豆腐', '杏鮑菇 + 高麗菜'],
    correct: 2, explanation: '花干、炸豆皮、百頁豆腐雖然是豆製品，但製程中經過油炸或添加大量油脂，極會吸附滷汁。'
  },
  {
    id: 'l3-c03', level: 3, category: 'Scenario', type: 'choice',
    question: '去吃平價牛排（如孫東寶、夜市牛排），怎麼吃熱量最低？',
    options: ['把鐵板麵吃光', '喝三碗玉米濃湯', '牛排不淋醬 + 麵換蛋', '餐包多吃兩顆'],
    correct: 2, explanation: '牛排醬（蘑菇/黑胡椒）含鈉與勾芡澱粉極高；鐵板麵是精緻澱粉。改吃肉配蛋是最佳低碳選。'
  },
  {
    id: 'l3-c04', level: 3, category: 'Scenario', type: 'choice',
    question: '在自助餐夾菜，下列哪道「看起來像蔬菜」的料理其實超油？',
    options: ['涼拌小黃瓜', '乾煸四季豆', '清蒸絲瓜', '燙青菜'],
    correct: 1, explanation: '乾煸四季豆通常需要先「過油（油炸）」保持色澤，再用油炒，吸油量非常驚人。'
  },
  {
    id: 'l3-c05', level: 3, category: 'Scenario', type: 'choice',
    question: '便利商店的「關東煮」區，想補蛋白質該夾什麼？',
    options: ['豬血糕', '黑輪', '黃金魚蛋', '油豆腐'],
    correct: 3, explanation: '雖然油豆腐有炸過，但在這選項中是唯一豆製品蛋白。更好的選擇是便利商店架上的茶葉蛋或溫泉蛋。(豬血糕是澱粉，黑輪魚蛋是加工漿類)。'
  },
  {
    id: 'l3-c06', level: 3, category: 'Scenario', type: 'choice',
    question: '吃火鍋時，服務生問你要什麼湯底，選哪種對減脂最有利？',
    options: ['麻辣鍋底', '牛奶起司鍋', '昆布蔬菜鍋', '沙茶鍋'],
    correct: 2, explanation: '昆布蔬菜湯底幾乎無油且熱量極低。麻辣與沙茶是油湯，牛奶鍋通常加了鮮奶油。'
  },
  {
    id: 'l3-c07', level: 3, category: 'Scenario', type: 'choice',
    question: '去Subway點餐，選哪種醬料熱量最低？',
    options: ['西南鄉村醬', '美乃滋 (Mayonnaise)', '蜂蜜芥末醬', '黃芥末 (Mustard) 或 紅酒醋'],
    correct: 3, explanation: '黃芥末與紅酒醋幾近零熱量。其他醬料基底多為美乃滋或糖漿。'
  },
  {
    id: 'l3-c08', level: 3, category: 'Scenario', type: 'choice',
    question: '想喝手搖飲，下列哪個配料的熱量與GI值相對較低？',
    options: ['波霸珍珠', '芋圓', '布丁', '愛玉 或 仙草(無糖)'],
    correct: 3, explanation: '珍珠芋圓是澱粉，布丁是糖跟油。愛玉與仙草如果不加糖水，熱量極低且富含膠質/纖維。'
  },
  // ==========================================
  // Level 3: True/False (是非題 - 外食實戰)
  // ==========================================
  {
    id: 'l3-b01', level: 3, category: 'Scenario', type: 'boolean',
    question: 'Q. (是非題) 自助餐的「茄子」雖然是蔬菜，但因為通常會用大量油炸來定色，所以熱量很高？',
    options: ['正確', '錯誤'], correct: 0, 
    explanation: '正確。自助餐的茄子通常是「油炸茄子」，茄子結構像海綿，吸油率極高。'
  },
  {
    id: 'l3-b02', level: 3, category: 'Scenario', type: 'boolean',
    question: 'Q. (是非題) 吃壽司（如藏壽司、壽司郎）是冷食很清爽，所以熱量一定比吃便當低？',
    options: ['正確', '錯誤'], correct: 1, 
    explanation: '錯誤。壽司米拌了醋跟大量的糖；且一顆壽司飯量不少，吃10盤可能攝取超過2碗飯的澱粉量。'
  },
  {
    id: 'l3-b03', level: 3, category: 'Scenario', type: 'boolean',
    question: 'Q. (是非題) 鹹水雞如果不加香油，只加蔥薑蒜水，是很好的減脂外食選擇？',
    options: ['正確', '錯誤'], correct: 0, 
    explanation: '正確。鹹水雞多為原型蔬菜與雞肉，只要避開「高鈉」胡椒與「香油」，非常適合減脂。'
  },
  {
    id: 'l3-b04', level: 3, category: 'Scenario', type: 'boolean',
    question: 'Q. (是非題) 早餐店的「鐵板麵」份量不大，加個蛋應該還算均衡？',
    options: ['正確', '錯誤'], correct: 1, 
    explanation: '錯誤。鐵板麵的醬汁通常含油含鈉極高，且麵體是精緻澱粉，是早餐店最地雷的選擇之一。'
  },
  {
    id: 'l3-b05', level: 3, category: 'Scenario', type: 'boolean',
    question: 'Q. (是非題) 麥當勞的「麥克雞塊」雖然是雞肉，但蛋白質比例遠低於「麥脆雞」？',
    options: ['正確', '錯誤'], correct: 0, 
    explanation: '正確。雞塊是組合肉混澱粉油炸，脂肪碳水高；麥脆雞去皮後是比較接近原型的肉類。'
  }
];

// --- Helper Functions ---

const getRandomQuestions = (level, countChoice = 10, countBool = 10) => {
  const levelQuestions = QUESTION_BANK.filter(q => q.level === level);
  const choiceQs = levelQuestions.filter(q => q.type === 'choice');
  const boolQs = levelQuestions.filter(q => q.type === 'boolean');

  const shuffle = (array) => {
    let newArr = [...array];
    for (let i = newArr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
    }
    return newArr;
  };

  const selectedChoice = shuffle(choiceQs).slice(0, countChoice);
  const selectedBool = shuffle(boolQs).slice(0, countBool);
  return [...selectedChoice, ...selectedBool];
};

// --- Components ---

const ProgressBar = ({ current, total }) => (
  <div className="w-full bg-slate-100 rounded-full h-2 mb-6 overflow-hidden">
    <div 
      className="bg-emerald-500 h-2 rounded-full transition-all duration-500 ease-out" 
      style={{ width: `${(current / total) * 100}%` }}
    ></div>
  </div>
);

const LevelBadge = ({ level, animate }) => (
  <div className={`flex items-center space-x-1.5 bg-white border border-slate-200 text-slate-800 px-3 py-1 rounded-full text-xs font-bold shadow-sm transition-transform ${animate ? 'scale-110 ring-2 ring-yellow-400' : ''}`}>
    <Award className={`w-3.5 h-3.5 text-yellow-500 ${animate ? 'animate-bounce' : ''}`} />
    <span>LV.{level}</span>
  </div>
);

const AnalysisCard = ({ title, score, suggestion, icon: Icon }) => (
  <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 mb-3">
    <div className="flex items-center justify-between mb-3">
      <div className="flex items-center space-x-3">
        <div className={`p-2 rounded-xl ${score < 60 ? 'bg-red-50 text-red-500' : 'bg-emerald-50 text-emerald-500'}`}>
          <Icon size={20} />
        </div>
        <h4 className="font-bold text-slate-800 text-base">{title}</h4>
      </div>
      <span className={`text-lg font-bold ${score < 60 ? 'text-red-500' : 'text-emerald-500'}`}>
        {score}%
      </span>
    </div>
    <div className="w-full bg-slate-50 h-2 rounded-full mb-3 overflow-hidden">
      <div 
        className={`h-2 rounded-full ${score < 60 ? 'bg-red-500' : 'bg-emerald-500'}`} 
        style={{ width: `${score}%` }}
      ></div>
    </div>
    <p className="text-sm text-slate-500 leading-relaxed">
      {suggestion}
    </p>
  </div>
);

// --- Main App Component ---

export default function App() {
  const [view, setView] = useState('home'); 
  const [currentLevel, setCurrentLevel] = useState(1); // User's highest unlocked level
  const [selectedLevel, setSelectedLevel] = useState(1); // User's chosen level to play
  const [quizLevel, setQuizLevel] = useState(1); // Actual level being played (after checks)
   
  const [activeQuestions, setActiveQuestions] = useState([]); 
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [showExplanation, setShowExplanation] = useState(false);
  const [isCorrect, setIsCorrect] = useState(null);
  const [answers, setAnswers] = useState([]); 
  const [selectedOption, setSelectedOption] = useState(null);
  const [isLevelUp, setIsLevelUp] = useState(false);
   
  // Learning Mode State
  const [activeChapter, setActiveChapter] = useState(null);

  // Glossary State
  const [searchTerm, setSearchTerm] = useState('');
  const [activeGlossaryItem, setActiveGlossaryItem] = useState(null);

  // Fitness Guide State
  const [activeGuideChapter, setActiveGuideChapter] = useState(null);

  // Persistence State
  const [user, setUser] = useState(null);
  const [isLoading, setIsLoading] = useState(true);
  const [userStats, setUserStats] = useState({ totalPlayed: 0, highestScore: 0 });

  // --- Auth & Persistence Effects ---
  useEffect(() => {
    if (!auth) {
      setIsLoading(false);
      return;
    }

    const initAuth = async () => {
      if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
        await signInWithCustomToken(auth, __initial_auth_token);
      } else {
        await signInAnonymously(auth);
      }
    };
    initAuth();

    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
      setUser(currentUser);
      if (!currentUser) setIsLoading(false);
    });
    return () => unsubscribe();
  }, []);

  useEffect(() => {
    if (!user || !db) return;

    const userDocRef = doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'stats');
    const unsubscribe = onSnapshot(userDocRef, (docSnap) => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        setCurrentLevel(data.currentLevel || 1);
        setSelectedLevel(data.currentLevel || 1);
        setUserStats({
          totalPlayed: data.totalPlayed || 0,
          highestScore: data.highestScore || 0
        });
      }
      setIsLoading(false);
    }, (error) => {
      console.error("Error fetching user data:", error);
      setIsLoading(false);
    });

    return () => unsubscribe();
  }, [user]);

  const saveProgress = async (newLevel, newScore) => {
    if (!user || !db) return;
    const userDocRef = doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'stats');
    
    // Optimistic update logic is handled by local state, this is just for DB sync
    const newStats = {
      currentLevel: Math.max(newLevel, currentLevel), // Keep highest unlocked
      totalPlayed: userStats.totalPlayed + 1,
      highestScore: Math.max(newScore, userStats.highestScore)
    };

    try {
      await setDoc(userDocRef, newStats, { merge: true });
    } catch (e) {
      console.error("Save failed", e);
    }
  };

  // Derived state
  const currentQuestion = activeQuestions[currentQuestionIndex];
  const isLastQuestion = activeQuestions.length > 0 && currentQuestionIndex === activeQuestions.length - 1;
  const PASS_THRESHOLD = 90;
  const MIN_QUESTIONS_PER_LEVEL = 10; 

  const handleStartQuiz = () => {
    // 1. Ensure target level is not higher than unlocked level
    let targetLevel = Math.min(selectedLevel, currentLevel);
    
    // 2. Generate Quiz
    let newQuiz = getRandomQuestions(targetLevel);
    
    // 3. Fallback Logic: If current level has too few questions, fallback to Level 1
    if (newQuiz.length < MIN_QUESTIONS_PER_LEVEL && targetLevel > 1) {
      alert(`LV.${targetLevel} 題庫建置中，暫時用 LV.1 題目練習！`);
      targetLevel = 1;
      newQuiz = getRandomQuestions(1);
    } 
    
    // 4. Safety Check
    if (newQuiz.length === 0) {
       alert("題庫載入異常，請重新整理");
       return;
    }

    setQuizLevel(targetLevel); // Set the actual level for this session
    setActiveQuestions(newQuiz);
    setView('quiz');
    setCurrentQuestionIndex(0);
    setScore(0);
    setAnswers([]);
    setShowExplanation(false);
    setSelectedOption(null);
    setIsLevelUp(false);
  };

  const handleAnswer = (optionIndex) => {
    if (showExplanation) return;
    const correct = optionIndex === currentQuestion.correct;
    setSelectedOption(optionIndex);
    setIsCorrect(correct);
    setShowExplanation(true);
    setAnswers(prev => [...prev, { category: currentQuestion.category, correct }]);
  };

  const handleNext = () => {
    if (isLastQuestion) {
      finishQuiz();
    } else {
      setCurrentQuestionIndex(prev => prev + 1);
      setShowExplanation(false);
      setSelectedOption(null);
      setIsCorrect(null);
    }
  };

  const finishQuiz = () => {
    const totalQuestions = activeQuestions.length;
    const correctCount = answers.filter(a => a.correct).length;
    const finalScore = totalQuestions > 0 ? Math.round((correctCount / totalQuestions) * 100) : 0;
    
    setScore(finalScore);

    let nextLevel = currentLevel;
    let didLevelUp = false;

    // Level Up Logic
    if (finalScore >= PASS_THRESHOLD && quizLevel === currentLevel) {
      didLevelUp = true;
      nextLevel = currentLevel + 1;
      setIsLevelUp(true);
      setCurrentLevel(nextLevel);
      setSelectedLevel(nextLevel); // Auto-select next level
    }

    // Save to Firebase
    saveProgress(nextLevel, finalScore);

    setView('analysis');
  };

  const getWeaknessAnalysis = () => {
    const stats = {};
    answers.forEach(a => {
      if (!stats[a.category]) stats[a.category] = { total: 0, correct: 0 };
      stats[a.category].total++;
      if (a.correct) stats[a.category].correct++;
    });

    return Object.keys(CATEGORY_CONFIG).map(key => {
      const config = CATEGORY_CONFIG[key];
      const data = stats[key];
      const percent = data ? Math.round((data.correct / data.total) * 100) : 0;
      return { 
        id: key, 
        name: config.name, 
        icon: config.icon, 
        advice: config.desc, 
        score: percent, 
        hasData: !!data 
      };
    }).filter(c => c.hasData);
  };

  // Memoize analysis results to avoid recalculation on render
  const weaknessAnalysis = useMemo(() => getWeaknessAnalysis(), [answers]);
   
  const getWeakestCategory = () => {
    if (weaknessAnalysis.length === 0) return null;
    return [...weaknessAnalysis].sort((a, b) => a.score - b.score)[0];
  };

  const weakestCategory = getWeakestCategory();

  const getSummaryText = () => {
    if (score >= 90) return '太強了！你對「隱形澱粉」與「假健康食物」超敏銳，已經有易瘦大腦的雛形。';
    if (score >= 70) return '表現不錯！你有基本的營養雷達，但還是有幾個常見陷阱會中招，再練幾次就很強。';
    return '目前多半是靠感覺吃東西，很適合把 LV1 多刷幾次，把基本觀念變成直覺反應。';
  };

  // --- Learning Mode Handlers ---
  const handleOpenChapter = (chapter) => {
    setActiveChapter(chapter);
    setView('learning_detail');
  };

  // --- Glossary Handlers ---
  const handleOpenGlossaryItem = (item) => {
    setActiveGlossaryItem(item);
    setView('glossary_detail');
  };

  const filteredGlossaryItems = GLOSSARY_ITEMS.filter(item => 
    item.term.toLowerCase().includes(searchTerm.toLowerCase()) || 
    item.english.toLowerCase().includes(searchTerm.toLowerCase()) ||
    item.category.toLowerCase().includes(searchTerm.toLowerCase())
  );

  const glossaryByCategory = filteredGlossaryItems.reduce((acc, item) => {
    if (!acc[item.category]) acc[item.category] = [];
    acc[item.category].push(item);
    return acc;
  }, {});

  // --- Guide Handlers ---
  const handleOpenGuide = (chapter) => {
    setActiveGuideChapter(chapter);
    setView('guide_chapter');
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-slate-50 flex items-center justify-center">
        <div className="flex flex-col items-center">
          <RefreshCcw className="w-8 h-8 text-emerald-500 animate-spin mb-4" />
          <p className="text-slate-500 font-bold">載入雲端紀錄中...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 flex justify-center selection:bg-emerald-100 selection:text-emerald-800">
      <div className="w-full max-w-md bg-white min-h-screen flex flex-col shadow-2xl relative border-x border-slate-50">
        
        {/* Header - Unified App Style */}
        <header className="bg-white/90 backdrop-blur-md text-slate-800 px-5 py-4 flex justify-between items-center sticky top-0 z-30 border-b border-slate-100 h-16">
          <div className="flex items-center space-x-2.5">
            <div className="bg-emerald-500 p-1.5 rounded-lg shadow-sm shadow-emerald-200">
              <Brain size={20} className="text-white" />
            </div>
            <h1 className="font-bold text-lg tracking-tight text-slate-900">Nutrition IQ</h1>
          </div>
          <div className="flex items-center space-x-3">
            
            {/* Glossary Button visible everywhere except during quiz */}
            {view !== 'quiz' && (
              <button 
                onClick={() => setView('glossary_hub')}
                className="flex items-center px-3 py-1.5 bg-gradient-to-r from-emerald-600 to-teal-600 rounded-full shadow-lg shadow-emerald-200 hover:scale-105 active:scale-95 transition-all group"
                title="名詞小字典"
              >
                <Book size={14} className="text-white mr-1.5" />
                <span className="text-xs font-bold text-white group-hover:text-emerald-50">名詞字典</span>
              </button>
            )}
            
            {/* Level Badge Logic */}
            {view === 'quiz' ? (
               <LevelBadge level={quizLevel} animate={false} />
            ) : (
               view !== 'learning_hub' && view !== 'learning_detail' && view !== 'glossary_hub' && view !== 'glossary_detail' && view !== 'guide_hub' && view !== 'guide_chapter' && (
                 <LevelBadge level={currentLevel} animate={view === 'analysis' && isLevelUp} />
               )
            )}
          </div>
        </header>

        {/* Content Area */}
        <main className="flex-1 overflow-y-auto bg-slate-50/50">
          
          {/* VIEW: HOME */}
          {view === 'home' && (
            <div className="p-6 flex flex-col min-h-full">
              {/* Hero Section */}
              <div className="mt-4 mb-8 text-center">
                <h2 className="text-3xl font-extrabold text-slate-900 mb-3 tracking-tight leading-tight">
                  飲食不是靠感覺<br/><span className="text-emerald-600">是靠「能力」</span>
                </h2>
                <p className="text-slate-500 text-base leading-relaxed">
                  透過測驗提升等級，<br/>或主動學習強化弱點。
                </p>
                
                {/* User Stats Pills */}
                <div className="flex justify-center mt-6 space-x-3">
                  <div className="flex items-center bg-white px-3 py-1.5 rounded-full border border-slate-200 shadow-sm text-xs font-bold text-slate-600">
                    <Trophy className="w-3.5 h-3.5 mr-1.5 text-yellow-500" />
                    最高分: {userStats.highestScore}
                  </div>
                  <div className="flex items-center bg-white px-3 py-1.5 rounded-full border border-slate-200 shadow-sm text-xs font-bold text-slate-600">
                    <Activity className="w-3.5 h-3.5 mr-1.5 text-emerald-500" />
                    練習: {userStats.totalPlayed}
                  </div>
                </div>
              </div>

              {/* Level Selector */}
              <div className="mb-8 flex justify-center space-x-2">
                {[1, 2, 3].map((lv) => {
                  const unlocked = lv <= currentLevel;
                  const isActive = lv === selectedLevel;
                  return (
                    <button
                      key={lv}
                      onClick={() => unlocked && setSelectedLevel(lv)}
                      disabled={!unlocked}
                      className={`px-4 py-2 rounded-full text-sm font-bold transition-all border ${
                        unlocked 
                          ? isActive 
                            ? 'bg-slate-800 text-white border-slate-800 shadow-md transform scale-105' 
                            : 'bg-white text-slate-600 border-slate-200 hover:border-slate-400'
                          : 'bg-slate-100 text-slate-300 border-slate-100 cursor-not-allowed'
                      }`}
                    >
                      {unlocked ? `LV.${lv}` : `LV.${lv} 🔒`}
                    </button>
                  );
                })}
              </div>

              <div className="space-y-4 pb-8">
                {/* NEW: Fitness Guide Entry Card */}
                <div className="mb-2">
                   <div className="flex items-center justify-between mb-2 px-1">
                      <h3 className="font-bold text-slate-800 flex items-center text-xs uppercase tracking-wider">
                        <Dumbbell className="w-4 h-4 mr-1.5 text-blue-500" />
                        特別企劃
                      </h3>
                   </div>
                   <button 
                     onClick={() => setView('guide_hub')}
                     className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-5 rounded-2xl shadow-lg shadow-blue-200 hover:shadow-xl transition-all active:scale-95 flex items-center justify-between group relative overflow-hidden"
                   >
                     <div className="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-10 -mt-10 blur-2xl"></div>
                     <div className="flex items-center text-left relative z-10">
                       <div className="bg-white/20 p-3.5 rounded-xl mr-4 backdrop-blur-sm border border-white/20">
                         <BookOpen className="text-white w-6 h-6" />
                       </div>
                       <div>
                         <div className="text-[10px] text-blue-100 font-bold uppercase tracking-wider mb-0.5">
                           Exclusive Guide
                         </div>
                         <div className="text-lg font-bold">健身新手入坑指南</div>
                         <div className="text-xs text-blue-100 mt-1 font-medium">從心態、飲食到菜單的全方位攻略</div>
                       </div>
                     </div>
                     <ChevronRight className="text-blue-200 group-hover:text-white transition-colors relative z-10" />
                   </button>
                </div>

                {/* Quiz Button - Primary Action */}
                <button 
                  onClick={handleStartQuiz}
                  className="w-full bg-slate-900 text-white p-5 rounded-2xl shadow-xl hover:bg-slate-800 transition-all active:scale-95 flex items-center justify-between group relative overflow-hidden"
                >
                  <div className="absolute inset-0 bg-gradient-to-br from-slate-800 to-black opacity-50" />
                  <div className="flex items-center text-left relative z-10">
                    <div className="bg-white/10 p-3.5 rounded-xl mr-4 backdrop-blur-sm">
                      <Zap className="text-yellow-400 w-6 h-6" />
                    </div>
                    <div>
                      <div className="text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-0.5">
                        Start Quiz • LV.{selectedLevel}
                      </div>
                      <div className="text-lg font-bold">開始能力測驗</div>
                    </div>
                  </div>
                  <ChevronRight className="text-slate-500 group-hover:text-white transition-colors relative z-10" />
                </button>

                {/* Learning Button - Secondary Action */}
                <button 
                  onClick={() => setView('learning_hub')}
                  className="w-full bg-white text-slate-800 border border-slate-100 p-5 rounded-2xl shadow-sm hover:border-emerald-500 hover:shadow-emerald-100 transition-all active:scale-95 flex items-center justify-between group"
                >
                  <div className="flex items-center text-left">
                    <div className="bg-emerald-50 p-3.5 rounded-xl mr-4">
                      <GraduationCap className="text-emerald-600 w-6 h-6" />
                    </div>
                    <div>
                      <div className="text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-0.5">Library</div>
                      <div className="text-lg font-bold">知識圖書館</div>
                    </div>
                  </div>
                  <ChevronRight className="text-slate-300 group-hover:text-emerald-500 transition-colors" />
                </button>
              </div>
            </div>
          )}

          {/* VIEW: LEARNING HUB (Chapter List) */}
          {view === 'learning_hub' && (
            <div className="p-6">
              <div className="flex items-center mb-6">
                <button 
                  onClick={() => setView('home')} 
                  className="mr-4 p-2 bg-white border border-slate-200 shadow-sm rounded-full hover:bg-slate-50 text-slate-600 transition-all"
                >
                  <ChevronLeft size={20} />
                </button>
                <h2 className="text-2xl font-bold text-slate-900">知識圖書館</h2>
              </div>

              <div className="space-y-4 pb-10">
                {KNOWLEDGE_LIBRARY.map((chapter) => {
                  const config = CATEGORY_CONFIG[chapter.categoryKey] || { name: chapter.categoryKey, icon: Book, desc: '' };
                  const Icon = config.icon;
                  
                  return (
                    <button 
                      key={chapter.id}
                      onClick={() => handleOpenChapter(chapter)}
                      className="w-full bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg hover:shadow-emerald-100 hover:border-emerald-200 transition-all text-left group relative overflow-hidden"
                    >
                      <div className="flex items-start justify-between mb-3 relative z-10">
                        <div className="flex items-center space-x-2">
                           <span className="bg-slate-900 text-white text-[10px] font-bold px-2 py-1 rounded">LV.{chapter.level}</span>
                           <span className="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded">{config.name}</span>
                        </div>
                      </div>
                      <h3 className="font-bold text-lg text-slate-800 leading-tight mb-2 relative z-10">{chapter.title}</h3>
                      <p className="text-sm font-medium text-slate-500 mb-4 relative z-10">
                        {chapter.subtitle}
                      </p>
                      
                      <div className="flex items-center text-xs text-slate-400 font-bold relative z-10">
                        <Clock size={14} className="mr-1.5" />
                        閱讀時間：{chapter.estimatedReadingMinutes} 分鐘
                      </div>

                      <Icon className="absolute -bottom-3 -right-3 w-20 h-20 text-slate-50 opacity-50 group-hover:text-emerald-50 group-hover:opacity-100 transition-all z-0 transform group-hover:scale-110" />
                    </button>
                  );
                })}
              </div>
            </div>
          )}

          {/* VIEW: LEARNING DETAIL */}
          {view === 'learning_detail' && activeChapter && (
            <div className="min-h-full bg-slate-50">
              <div className="sticky top-0 bg-white/90 backdrop-blur-md z-10 border-b border-slate-100 px-6 py-4 flex items-center">
                <button 
                  onClick={() => setView('learning_hub')} 
                  className="mr-4 p-2 bg-slate-50 border border-slate-200 rounded-full hover:bg-slate-100 text-slate-600 transition-all"
                >
                  <ChevronLeft size={20} />
                </button>
                <div className="flex-1 min-w-0">
                    <div className="text-[10px] text-emerald-600 font-bold uppercase tracking-wider mb-0.5">LV.{activeChapter.level} • {CATEGORY_CONFIG[activeChapter.categoryKey]?.name}</div>
                    <h2 className="text-base font-bold text-slate-800 truncate leading-tight">
                      {activeChapter.title}
                    </h2>
                </div>
              </div>

              <div className="p-6 space-y-6 pb-20">
                <div className="bg-gradient-to-br from-emerald-50 to-white p-6 rounded-2xl border border-emerald-100/50 shadow-sm">
                  <h3 className="font-bold text-emerald-900 mb-3 text-lg leading-snug">{activeChapter.subtitle}</h3>
                  <p className="text-slate-700 leading-relaxed text-sm">
                    {activeChapter.summary}
                  </p>
                </div>

                <div>
                  <h4 className="flex items-center font-bold text-slate-800 mb-4 text-base">
                    <CheckCircle2 className="w-5 h-5 text-emerald-500 mr-2.5" />
                    重點觀念
                  </h4>
                  <ul className="space-y-3">
                    {activeChapter.keyPoints.map((point, idx) => (
                      <li key={idx} className="flex items-start bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                        <div className="min-w-[6px] h-[6px] rounded-full bg-emerald-400 mt-2 mr-3.5"></div>
                        <span className="text-sm text-slate-600 leading-relaxed">{point}</span>
                      </li>
                    ))}
                  </ul>
                </div>

                <div>
                  <h4 className="flex items-center font-bold text-slate-800 mb-4 text-base">
                    <AlertTriangle className="w-5 h-5 text-orange-500 mr-2.5" />
                    常見誤區
                  </h4>
                  <ul className="space-y-3">
                    {activeChapter.commonMistakes.map((mistake, idx) => (
                      <li key={idx} className="flex items-start bg-orange-50/50 p-4 rounded-xl border border-orange-100">
                        <XCircle className="w-4 h-4 text-orange-400 mt-0.5 mr-3 flex-shrink-0" />
                        <span className="text-sm text-slate-700 leading-relaxed">{mistake}</span>
                      </li>
                    ))}
                  </ul>
                </div>

                 <div>
                  <h4 className="flex items-center font-bold text-slate-800 mb-4 text-base">
                    <Lightbulb className="w-5 h-5 text-yellow-500 mr-2.5" />
                    生活實例
                  </h4>
                  <ul className="space-y-3">
                    {activeChapter.examples.map((ex, idx) => (
                      <li key={idx} className="bg-slate-50 p-4 rounded-xl border border-slate-200 text-sm text-slate-600 leading-relaxed italic">
                        "{ex}"
                      </li>
                    ))}
                  </ul>
                </div>

                <div className="bg-slate-900 rounded-2xl p-6 text-white shadow-xl shadow-slate-200">
                  <h4 className="flex items-center font-bold text-yellow-400 mb-4 text-base">
                    <Star className="w-5 h-5 mr-2.5" />
                    今日小任務
                  </h4>
                  <ul className="space-y-4">
                    {activeChapter.tinyActions.map((action, idx) => (
                      <li key={idx} className="flex items-start">
                          <div className="bg-white/10 p-1.5 rounded-lg mr-3.5 mt-0.5">
                            <Target className="w-3 h-3 text-emerald-400" />
                          </div>
                          <span className="text-sm text-slate-300 leading-relaxed">{action}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            </div>
          )}

          {/* VIEW: GLOSSARY HUB */}
          {view === 'glossary_hub' && (
            <div className="p-6">
              <div className="flex items-center mb-6">
                <button 
                  onClick={() => setView('home')} 
                  className="mr-4 p-2 bg-white border border-slate-200 shadow-sm rounded-full hover:bg-slate-50 text-slate-600 transition-all"
                >
                  <ChevronLeft size={20} />
                </button>
                <h2 className="text-2xl font-bold text-slate-900">名詞小字典</h2>
              </div>

              {/* Search Bar */}
              <div className="relative mb-8 group">
                <div className="absolute inset-y-0 left-4 flex items-center pointer-events-none">
                  <Search className="w-5 h-5 text-slate-400 group-focus-within:text-emerald-500 transition-colors" />
                </div>
                <input 
                  type="text" 
                  placeholder="搜尋名詞 (如：蛋白質、Protein...)" 
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full py-4 pl-12 pr-4 rounded-2xl border border-slate-200 bg-white shadow-sm focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100 focus:outline-none transition-all text-slate-800 placeholder:text-slate-400"
                />
              </div>

              {/* Grouped List */}
              <div className="space-y-8 pb-12">
                {Object.keys(glossaryByCategory).length > 0 ? (
                  Object.keys(glossaryByCategory).map((category) => (
                    <div key={category} className="animate-in fade-in slide-in-from-bottom-2 duration-500">
                      <h3 className="font-bold text-emerald-800 mb-4 px-1 flex items-center text-sm uppercase tracking-wider">
                        <span className="w-1.5 h-1.5 rounded-full bg-emerald-500 mr-2.5"></span>
                        {category}
                      </h3>
                      <div className="grid gap-3">
                        {glossaryByCategory[category].map((item, idx) => (
                          <button 
                            key={idx}
                            onClick={() => handleOpenGlossaryItem(item)}
                            className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm text-left hover:border-emerald-200 hover:shadow-md transition-all group flex flex-col"
                          >
                            <div className="flex justify-between items-start mb-1.5">
                              <div className="flex flex-col">
                                <span className="font-bold text-slate-800 text-lg group-hover:text-emerald-700 transition-colors">
                                  {item.term}
                                </span>
                                <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wide">
                                  {item.english}
                                </span>
                              </div>
                              <ChevronRight size={18} className="text-slate-300 group-hover:text-emerald-500 mt-1 transition-transform group-hover:translate-x-1" />
                            </div>
                            <p className="text-sm text-slate-500 line-clamp-1 border-t border-slate-50 pt-2 mt-1">
                              {item.oneLine}
                            </p>
                          </button>
                        ))}
                      </div>
                    </div>
                  ))
                ) : (
                  <div className="text-center py-16 text-slate-400">
                    <Search size={48} className="mx-auto mb-4 opacity-20" />
                    <p className="font-medium">找不到相關名詞</p>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* VIEW: GLOSSARY DETAIL */}
          {view === 'glossary_detail' && activeGlossaryItem && (
            <div className="min-h-full bg-slate-50">
              <div className="sticky top-0 bg-white/90 backdrop-blur-md z-10 border-b border-slate-100 px-6 py-4 flex items-center">
                <button 
                  onClick={() => setView('glossary_hub')} 
                  className="mr-4 p-2 bg-slate-50 border border-slate-200 rounded-full hover:bg-slate-100 text-slate-600 transition-all"
                >
                  <ChevronLeft size={20} />
                </button>
                <div className="flex-1 min-w-0">
                    <div className="text-[10px] text-emerald-600 font-bold uppercase tracking-wider mb-0.5">GLOSSARY</div>
                    <h2 className="text-base font-bold text-slate-800 truncate">
                      {activeGlossaryItem.term}
                    </h2>
                </div>
              </div>

              <div className="p-6 space-y-6">
                {/* Header Card */}
                <div className="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm text-center">
                  <span className="inline-block bg-emerald-50 text-emerald-700 text-[10px] font-bold px-3 py-1 rounded-full mb-4 uppercase tracking-wider border border-emerald-100">
                    {activeGlossaryItem.category}
                  </span>
                  <h2 className="text-3xl font-extrabold text-slate-900 mb-1 tracking-tight">{activeGlossaryItem.term}</h2>
                  <p className="text-slate-400 font-bold text-sm mb-6 uppercase tracking-wide">{activeGlossaryItem.english}</p>
                  <div className="bg-slate-50 p-5 rounded-2xl text-slate-700 font-medium leading-relaxed text-sm">
                    {activeGlossaryItem.oneLine}
                  </div>
                </div>

                {/* Why It Matters */}
                <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                  <h4 className="flex items-center font-bold text-slate-800 mb-3 text-sm uppercase tracking-wide">
                    <Info size={18} className="text-blue-500 mr-2.5" />
                    為什麼重要？
                  </h4>
                  <p className="text-slate-600 text-sm leading-relaxed">
                    {activeGlossaryItem.whyItMatters}
                  </p>
                </div>

                {/* Sources */}
                {activeGlossaryItem.typicalSources && (
                  <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <h4 className="flex items-center font-bold text-slate-800 mb-3 text-sm uppercase tracking-wide">
                      <ShoppingBag size={18} className="text-orange-500 mr-2.5" />
                      常見來源
                    </h4>
                    <p className="text-slate-600 text-sm leading-relaxed">
                      {activeGlossaryItem.typicalSources}
                    </p>
                  </div>
                )}

                {/* On Label */}
                {activeGlossaryItem.onLabel && (
                  <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <h4 className="flex items-center font-bold text-slate-800 mb-3 text-sm uppercase tracking-wide">
                      <Tag size={18} className="text-purple-500 mr-2.5" />
                      包裝常見標示
                    </h4>
                    <div className="bg-slate-50 px-3 py-2 rounded-lg inline-block border border-slate-100">
                      <p className="text-slate-600 text-sm font-mono font-medium">
                        {activeGlossaryItem.onLabel}
                      </p>
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* VIEW: QUIZ */}
          {view === 'quiz' && currentQuestion && (
            <div className="p-6 flex flex-col h-full bg-slate-50">
              <div className="mb-6">
                <div className="flex justify-between items-center mb-3">
                  <span className={`text-[10px] font-bold px-2.5 py-1 rounded-full uppercase tracking-wide shadow-sm ${currentQuestion.type === 'boolean' ? 'bg-blue-50 text-blue-600 border border-blue-100' : 'bg-emerald-50 text-emerald-600 border border-emerald-100'}`}>
                    {currentQuestion.type === 'boolean' ? '是非題' : '選擇題'}
                  </span>
                  <span className="text-xs font-bold text-slate-400">
                    Q{currentQuestionIndex + 1} <span className="text-slate-300">/</span> {activeQuestions.length}
                  </span>
                </div>
                <ProgressBar current={currentQuestionIndex + 1} total={activeQuestions.length} />
                <h3 className="text-2xl font-bold text-slate-900 mt-4 leading-snug">
                  {currentQuestion.question}
                </h3>
              </div>
              <div className="space-y-3 flex-1 overflow-y-auto pb-6">
                <div className={currentQuestion.type === 'boolean' ? "grid grid-cols-2 gap-4" : "space-y-3"}>
                  {currentQuestion.options.map((option, idx) => {
                    let btnClass = "p-5 rounded-2xl border-2 text-left transition-all duration-200 font-medium relative flex items-center ";
                    if (currentQuestion.type === 'boolean') {
                        btnClass += "h-40 justify-center text-center text-xl flex-col shadow-sm ";
                    } else {
                        btnClass += "w-full justify-between shadow-sm ";
                    }

                    if (showExplanation) {
                      if (idx === currentQuestion.correct) btnClass += "border-emerald-500 bg-emerald-50 text-emerald-800 shadow-none";
                      else if (idx === selectedOption) btnClass += "border-red-400 bg-red-50 text-red-800 shadow-none";
                      else btnClass += "border-slate-100 text-slate-300 opacity-50 shadow-none";
                    } else {
                      btnClass += "border-white bg-white text-slate-700 hover:border-emerald-200 hover:shadow-md";
                    }

                    return (
                      <button key={idx} onClick={() => handleAnswer(idx)} disabled={showExplanation} className={btnClass}>
                        <span className={currentQuestion.type === 'boolean' ? "font-bold" : "text-sm md:text-base"}>{option}</span>
                        {showExplanation && currentQuestion.type !== 'boolean' && idx === currentQuestion.correct && <CheckCircle2 size={20} className="text-emerald-500 flex-shrink-0 ml-3" />}
                        {showExplanation && currentQuestion.type !== 'boolean' && idx === selectedOption && idx !== currentQuestion.correct && <XCircle size={20} className="text-red-500 flex-shrink-0 ml-3" />}
                      </button>
                    );
                  })}
                </div>
              </div>
              
              {/* Feedback Overlay Card */}
              {showExplanation && (
                <div className="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur shadow-[0_-4px_20px_-5px_rgba(0,0,0,0.1)] rounded-t-3xl border-t border-slate-100 z-50 animate-in slide-in-from-bottom duration-300 max-w-md mx-auto">
                  <div className={`p-5 rounded-2xl mb-4 border ${isCorrect ? 'bg-emerald-50 border-emerald-100' : 'bg-orange-50 border-orange-100'}`}>
                    <div className="flex items-center justify-between mb-3 pb-3 border-b border-black/5">
                        <span className={`text-xs font-bold uppercase tracking-wider flex items-center ${isCorrect ? 'text-emerald-700' : 'text-orange-700'}`}>
                          {isCorrect ? <CheckCircle2 className="w-4 h-4 mr-2"/> : <AlertTriangle className="w-4 h-4 mr-2"/>}
                          {isCorrect ? 'Correct Answer' : 'Incorrect'}
                        </span>
                    </div>
                    <div className="flex items-start gap-3">
                      <Brain size={20} className={`mt-0.5 flex-shrink-0 ${isCorrect ? "text-emerald-600" : "text-orange-600"}`} />
                      <div>
                        <span className={`font-bold text-sm block mb-1 ${isCorrect ? "text-emerald-800" : "text-orange-800"}`}>
                          AI 解析
                        </span>
                        <p className="text-slate-700 text-sm leading-relaxed">{currentQuestion.explanation}</p>
                      </div>
                    </div>
                  </div>
                  <button 
                    onClick={handleNext} 
                    className="w-full bg-slate-900 text-white py-4 rounded-xl font-bold hover:bg-slate-800 transition-transform active:scale-95 shadow-lg"
                  >
                    {isLastQuestion ? '查看成績' : '下一題'}
                  </button>
                </div>
              )}
            </div>
          )}

          {/* VIEW: ANALYSIS */}
          {view === 'analysis' && (
            <div className="p-6 bg-slate-50 min-h-full">
              
              {/* Score Card */}
              <div className="bg-white rounded-3xl p-8 shadow-sm border border-slate-100 text-center mb-6 relative overflow-hidden">
                <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-emerald-400 to-teal-500"></div>
                {isLevelUp ? (
                  <div className="animate-in zoom-in duration-500">
                    <div className="inline-block p-4 bg-yellow-100 rounded-full mb-4 shadow-inner">
                      <ArrowUpCircle size={48} className="text-yellow-500 animate-bounce" />
                    </div>
                    <h2 className="text-2xl font-bold text-slate-800 mb-1">Level Up!</h2>
                    <p className="text-slate-500 text-sm mb-4">恭喜晉升 LV.{currentLevel}</p>
                  </div>
                ) : (
                  <div className="mb-4">
                    <div className="inline-block p-4 bg-slate-100 rounded-full mb-4 shadow-inner">
                      <Award size={48} className="text-slate-400" />
                    </div>
                    <h2 className="text-xl font-bold text-slate-800">挑戰完成</h2>
                  </div>
                )}
                
                <div className="flex justify-center items-baseline space-x-1">
                  <span className="text-6xl font-black text-slate-900 tracking-tighter">{score}</span>
                  <span className="text-xl font-bold text-slate-400">/ 100</span>
                </div>
              </div>

              {/* AI Summary */}
              <div className="mb-6 bg-white border border-slate-100 shadow-sm rounded-2xl p-5 text-center">
                  <h4 className="font-bold text-slate-800 text-xs uppercase tracking-widest mb-3 flex items-center justify-center">
                    <Brain className="w-4 h-4 mr-2 text-emerald-500"/> AI 營養師總評
                  </h4>
                  <p className="text-sm text-slate-600 leading-relaxed font-medium">{getSummaryText()}</p>
              </div>

              {/* Next Step */}
              {weakestCategory && (
                <div className="bg-white p-5 rounded-2xl border border-emerald-100 shadow-sm mb-6 flex items-start relative overflow-hidden">
                  <div className="absolute left-0 top-0 bottom-0 w-1 bg-emerald-400"></div>
                  <Lightbulb className="text-emerald-500 w-5 h-5 mr-3.5 mt-0.5 flex-shrink-0" />
                  <div>
                    <h4 className="font-bold text-slate-800 text-sm mb-1">下一步建議</h4>
                    <p className="text-xs text-slate-500 leading-relaxed">
                      系統發現你的最大弱點是 <span className="font-bold text-emerald-600">「{weakestCategory.name}」</span>。
                      建議前往「知識圖書館」閱讀該章節，或再刷一次測驗！
                    </p>
                  </div>
                </div>
              )}

              {/* Radar Grid */}
              <div className="space-y-3 pb-24">
                <h3 className="font-bold text-slate-900 text-lg mb-4 flex items-center px-1">
                  <Activity size={20} className="mr-2 text-emerald-500" />
                  能力透視
                </h3>
                {weaknessAnalysis.map((stat, idx) => (
                  <AnalysisCard key={idx} title={stat.name} score={stat.score} suggestion={stat.advice} icon={stat.icon} />
                ))}
              </div>

              {/* Bottom Fixed Action Bar */}
              <div className="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur border-t border-slate-100 z-40 max-w-md mx-auto">
                <div className="flex space-x-3">
                    <button 
                     onClick={handleStartQuiz} 
                     className="flex-1 bg-white text-slate-800 border-2 border-slate-200 py-3.5 rounded-xl font-bold shadow-sm hover:bg-slate-50 active:scale-95 transition-all flex items-center justify-center"
                    >
                     <RefreshCcw className="mr-2 w-4 h-4" />
                     再試一次
                   </button>
                  <button 
                    onClick={() => setView('home')} 
                    className="flex-1 bg-slate-900 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-slate-200 hover:bg-slate-800 active:scale-95 transition-all"
                  >
                    回到首頁
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* VIEW: GUIDE HUB (TOC) */}
          {view === 'guide_hub' && (
            <div className="p-6 bg-slate-50 min-h-screen">
              <div className="flex items-center mb-6">
                <button 
                  onClick={() => setView('home')} 
                  className="mr-4 p-2 bg-white border border-slate-200 shadow-sm rounded-full hover:bg-slate-50 text-slate-600 transition-all"
                >
                  <ChevronLeft size={20} />
                </button>
                <h2 className="text-2xl font-bold text-slate-900">健身新手指南</h2>
              </div>

              <div className="mb-6 bg-blue-50 p-4 rounded-2xl border border-blue-100 flex items-start">
                <Info className="w-5 h-5 text-blue-500 mr-3 mt-0.5 flex-shrink-0" />
                <p className="text-sm text-blue-800 leading-relaxed">
                  這不只是一份訓練菜單，這是一份你與自己簽下的契約。獻給所有決定重生的你。
                </p>
              </div>

              <div className="space-y-3 pb-10">
                {FITNESS_GUIDE_DATA.map((chapter, idx) => (
                  <button 
                    key={chapter.id}
                    onClick={() => handleOpenGuide(chapter)}
                    className="w-full bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md hover:border-blue-200 transition-all text-left group"
                  >
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded uppercase tracking-wider">
                        Chapter {idx}
                      </span>
                      <span className="text-xs text-slate-400 font-medium flex items-center">
                        <Clock size={12} className="mr-1" /> {chapter.readTime}
                      </span>
                    </div>
                    <h3 className="font-bold text-lg text-slate-800 mb-1 group-hover:text-blue-700 transition-colors">
                      {chapter.title}
                    </h3>
                    <p className="text-sm text-slate-500 font-medium">
                      {chapter.subtitle}
                    </p>
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* VIEW: GUIDE CHAPTER READER */}
          {view === 'guide_chapter' && activeGuideChapter && (
            <div className="min-h-full bg-white">
              <div className="sticky top-0 bg-white/95 backdrop-blur-md z-10 border-b border-slate-100 px-6 py-4 flex items-center">
                <button 
                  onClick={() => setView('guide_hub')} 
                  className="mr-4 p-2 bg-slate-50 border border-slate-200 rounded-full hover:bg-slate-100 text-slate-600 transition-all"
                >
                  <ChevronLeft size={20} />
                </button>
                <div className="flex-1 min-w-0">
                   <div className="text-[10px] text-blue-600 font-bold uppercase tracking-wider mb-0.5">FITNESS GUIDE</div>
                   <h2 className="text-base font-bold text-slate-800 truncate">
                     {activeGuideChapter.title}
                   </h2>
                </div>
              </div>

              <div className="p-6 pb-20 max-w-2xl mx-auto">
                <div className="mb-8">
                  <h1 className="text-2xl font-extrabold text-slate-900 mb-2">{activeGuideChapter.title}</h1>
                  <p className="text-lg text-slate-500 font-medium">{activeGuideChapter.subtitle}</p>
                </div>

                <div className="space-y-8">
                  {activeGuideChapter.content.map((block, idx) => {
                    switch (block.type) {
                      case 'text':
                        return <p key={idx} className="text-slate-700 leading-8 text-base whitespace-pre-line">{block.text}</p>;
                      
                      case 'quote':
                        return (
                          <div key={idx} className="border-l-4 border-blue-500 pl-4 py-1 my-6 bg-slate-50 rounded-r-xl p-4 italic text-slate-700 whitespace-pre-line">
                            {block.text}
                          </div>
                        );

                      case 'highlight':
                        return (
                          <div key={idx} className="bg-orange-50 p-6 rounded-2xl border border-orange-100 my-6">
                            <h4 className="font-bold text-orange-800 mb-3 flex items-center">
                              <AlertTriangle size={18} className="mr-2" />
                              {block.title}
                            </h4>
                            <p className="text-orange-900/80 whitespace-pre-line leading-relaxed text-sm">
                              {block.text}
                            </p>
                          </div>
                        );

                      case 'section':
                        return (
                          <h3 key={idx} className="text-xl font-bold text-slate-900 mt-8 mb-4 border-b border-slate-100 pb-2">
                            {block.title}
                          </h3>
                        );

                      case 'list':
                        return (
                          <ul key={idx} className="space-y-3 my-4">
                            {block.items.map((item, i) => (
                              <li key={i} className="flex items-start">
                                <div className="min-w-[6px] h-[6px] rounded-full bg-blue-500 mt-2.5 mr-3 flex-shrink-0"></div>
                                <span className="text-slate-700 leading-relaxed whitespace-pre-line">{item}</span>
                              </li>
                            ))}
                          </ul>
                        );

                      case 'card':
                        return (
                          <div key={idx} className="bg-slate-50 p-5 rounded-xl border border-slate-200 my-4 shadow-sm">
                            <h4 className="font-bold text-slate-800 mb-2">{block.title}</h4>
                            <p className="text-sm text-slate-600 whitespace-pre-line leading-relaxed">
                              {block.content}
                            </p>
                          </div>
                        );
                      
                      default:
                        return null;
                    }
                  })}
                </div>

                <div className="mt-12 pt-8 border-t border-slate-100 text-center">
                  <button 
                     onClick={() => setView('guide_hub')}
                     className="text-blue-600 font-bold text-sm hover:underline"
                  >
                    回到目錄
                  </button>
                </div>
              </div>
            </div>
          )}

        </main>
      </div>
    </div>
  );
}